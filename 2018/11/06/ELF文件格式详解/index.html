<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="ELF," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="前情提要需求想写不落地加载dex的壳，但是想要加载dex的同时还可以oat就必须涉及到hook了，于是决定彻底扫一遍hook。但看了几篇文后发现….ELF文件格式都忘了差不多了、linker与exec还没看…..还是因为当初看的时候手太懒了没有动手写啊………. 于是先从一篇完整的elf文件格式解析写起readelf真的好用…… hook基本都是c++写的，因此解析也用c++写好点因为我的机子都是6">
<meta name="keywords" content="ELF">
<meta property="og:type" content="article">
<meta property="og:title" content="ELF文件格式详解">
<meta property="og:url" content="http://yoursite.com/2018/11/06/ELF文件格式详解/index.html">
<meta property="og:site_name" content="GGWP">
<meta property="og:description" content="前情提要需求想写不落地加载dex的壳，但是想要加载dex的同时还可以oat就必须涉及到hook了，于是决定彻底扫一遍hook。但看了几篇文后发现….ELF文件格式都忘了差不多了、linker与exec还没看…..还是因为当初看的时候手太懒了没有动手写啊………. 于是先从一篇完整的elf文件格式解析写起readelf真的好用…… hook基本都是c++写的，因此解析也用c++写好点因为我的机子都是6">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://i.imgur.com/BMj6qpj.png">
<meta property="og:image" content="https://i.imgur.com/Cc6dCwQ.png">
<meta property="og:image" content="https://i.imgur.com/RVRaTEv.png">
<meta property="og:image" content="https://i.imgur.com/MNYcFJH.png">
<meta property="og:image" content="https://i.imgur.com/TqEDYFo.png">
<meta property="og:image" content="https://i.imgur.com/31RrnM4.png">
<meta property="og:image" content="https://i.imgur.com/8l2Ps0C.png">
<meta property="og:image" content="https://i.imgur.com/SsFfAQE.png">
<meta property="og:image" content="https://i.imgur.com/Slc8Fg9.png">
<meta property="og:image" content="https://i.imgur.com/EOB8ity.png">
<meta property="og:image" content="https://i.imgur.com/AISLwhh.png">
<meta property="og:image" content="https://i.imgur.com/lVP2J6Q.png">
<meta property="og:image" content="https://i.imgur.com/osHe9oH.png">
<meta property="og:image" content="https://i.imgur.com/CeffDqZ.png">
<meta property="og:image" content="https://i.imgur.com/Y25pX1x.png">
<meta property="og:image" content="https://i.imgur.com/SNz1mjh.png">
<meta property="og:image" content="https://i.imgur.com/PlDTBOD.png">
<meta property="og:updated_time" content="2018-11-26T04:18:05.348Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ELF文件格式详解">
<meta name="twitter:description" content="前情提要需求想写不落地加载dex的壳，但是想要加载dex的同时还可以oat就必须涉及到hook了，于是决定彻底扫一遍hook。但看了几篇文后发现….ELF文件格式都忘了差不多了、linker与exec还没看…..还是因为当初看的时候手太懒了没有动手写啊………. 于是先从一篇完整的elf文件格式解析写起readelf真的好用…… hook基本都是c++写的，因此解析也用c++写好点因为我的机子都是6">
<meta name="twitter:image" content="https://i.imgur.com/BMj6qpj.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/11/06/ELF文件格式详解/"/>





  <title>ELF文件格式详解 | GGWP</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">GGWP</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/06/ELF文件格式详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="imbaya">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/1.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GGWP">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ELF文件格式详解</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-06T21:36:01+08:00">
                2018-11-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h1><p>需求想写不落地加载dex的壳，但是想要加载dex的同时还可以oat就必须涉及到hook了，于是决定彻底扫一遍hook。但看了几篇文后发现….ELF文件格式都忘了差不多了、linker与exec还没看…..<br>还是因为当初看的时候手太懒了没有动手写啊……….</p>
<p>于是先从一篇完整的elf文件格式解析写起<br>readelf真的好用……</p>
<p>hook基本都是c++写的，因此解析也用c++写好点<br>因为我的机子都是64位的，因此解析android arm-64位下的so为目的</p>
<p>由于许多书籍对elf中的名词描述不同，因此采用如下翻译：</p>
<table>
<thead>
<tr>
<th>汉语</th>
<th>英语</th>
</tr>
</thead>
<tbody>
<tr>
<td>ELF文件头</td>
<td>ELF header</td>
</tr>
<tr>
<td>基地址</td>
<td>base address</td>
</tr>
<tr>
<td>动态连接器</td>
<td>dynamic linker</td>
</tr>
<tr>
<td>全局偏移量表</td>
<td>global offset table</td>
</tr>
<tr>
<td>初始化函数</td>
<td>initialization function</td>
</tr>
<tr>
<td>函数连接表</td>
<td>procedure linkage table</td>
</tr>
<tr>
<td>程序头</td>
<td>program header</td>
</tr>
<tr>
<td>节</td>
<td>section</td>
</tr>
<tr>
<td>段</td>
<td>segment</td>
</tr>
</tbody>
</table>
<p>此外本篇将地址区分为三种：<br>逻辑地址：指由程序产生的与段相关的偏移地址部分。也就是段*16+的那个值。<br>虚拟地址/线性地址：为进程虚拟的地址空间<br>物理地址：实际地址空间</p>
<p>现在从逻辑地址到虚拟地址还要经过一次保护模式分段机制。简述就是保护模式将段的信息存于GDT与LDT中，段寄存器存其表的索引值。<br>32位Linux中逻辑地址等于线性地址，因为Linux所有的段（用户代码段、用户数据段、内核代码段、内核数据段）的线性地址都是从 0x00000000 开始，长度4G，这样 线性地址=逻辑地址+ 0x00000000，也就是说逻辑地址等于线性地址了。<br>现在先认为elf中的都是虚拟地址。等搞清保护模式机制时阅读exec与linker再分析地址问题。64位下的机制貌似很不一样…….</p>
<p>ps:elf不是精灵的意思么….之后根据linker写elf壳的时候就叫darkelf好了….<br><a id="more"></a></p>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>由于考虑到对各种不同硬件和操作系统的适用性和扩展性，ELF(v1.2)规范在制 定时，把 ELF格式分为了三个层次。<br>第一层是基本的部分，即格式中通用的部 分，这部分在各种处理器架构和操作系统上都是相同的；<br>第二层是处理器的扩展部 分，这部分会因处理器架构的不同而不同，规范中只定义了针对 Intel i386架构的内容，针对其它的处理器的内容由处理器厂商自己提供；<br>第三层是操作系统的扩展 部分，这部分内容在不同的操作系统下面也可能是不同的，规范中只定义了针对 UNIX System V Release 4操作系统的内容。<br>90年代发布的ELF1.2标准，因此本篇参考该标准解析。由于该文件只是规范，并且有根据不同厂商扩展的部分，<strong>实际一切以现有的ARM64-android为分析源</strong></p>
<h2 id="文件类型"><a href="#文件类型" class="headerlink" title="文件类型"></a>文件类型</h2><p>ELF文件的类型：可重定位文件(.o .a)、可执行文件、共享文件(.so)、转存文件</p>
<h3 id="可重定位文件"><a href="#可重定位文件" class="headerlink" title="可重定位文件"></a>可重定位文件</h3><p>用于与其它目标文件进行连接以构建可执行文件或动态链接库。可重定位文件就是常说的目标文件，由源文件编译而成，但还 没有连接成可执行文件。在 UNIX系统下，一般有扩展名”.o”。之所以称其为“可 重定位”，是因为在这些文件中，如果引用到其它目标文件或库文件中定义的符号 （变量或者函数）的话，只是给出一个名字，这里还并不知道这个符号在哪里，其具体的地址是什么。需要在连接的过程中，把对这些外部符号的引用重新定位到其 真正定义的位置上，所以称目标文件为“可重定位”或者“待重定位”的。 .a是.o的集合</p>
<h3 id="共享目标文件"><a href="#共享目标文件" class="headerlink" title="共享目标文件"></a>共享目标文件</h3><p>即动态连接库文件。它在以下两种情况下被使用：第一，在连接过程中与其它动态链接库或可重定位文件一起构建新的目标 文件；第二，在可执行文件被加载的过程中，被动态链接到新的进程中，成为运行 代码的一部分。 </p>
<h3 id="可执行文件"><a href="#可执行文件" class="headerlink" title="可执行文件"></a>可执行文件</h3><p>经过连接的，可以执行的程序文件。</p>
<h2 id="文件格式概观"><a href="#文件格式概观" class="headerlink" title="文件格式概观"></a>文件格式概观</h2><p>ELF文件根据用途不同可被看成的内容不同</p>
<p><img src="https://i.imgur.com/BMj6qpj.png" alt=""></p>
<p>用于构建程序或者用于运行程序</p>
<p><strong>注意实际上elf文件只有文件头的位置是固定的，其它内容的位置都可以变化</strong></p>
<h3 id="ELF文件头"><a href="#ELF文件头" class="headerlink" title="ELF文件头"></a>ELF文件头</h3><p>位于文件的开始处，包含有整个文件的结构信息。 </p>
<h3 id="节-section"><a href="#节-section" class="headerlink" title="节(section)"></a>节(section)</h3><p>是专用于连接过程而言的，在每个“节”中包含有指令数据、符号数据、重 定位数据等等。</p>
<h3 id="程序头表-program-header-table"><a href="#程序头表-program-header-table" class="headerlink" title="程序头表(program header table)"></a>程序头表(program header table)</h3><p>在运行过程中是必须的，在连接过程中是可选的，因为它的作用是告诉系统 如何创建进程的镜像。 </p>
<h3 id="节头表-section-header-table"><a href="#节头表-section-header-table" class="headerlink" title="节头表 (section header table)"></a>节头表 (section header table)</h3><p>包含有文件中所有“节”的信息。在连接视图中，“节头表”是必须存在 的，文件里的每一个“节”都需要在“节头表”中有一个对应的注册项，这个注册 项描述了节的名字、大小等等。 </p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>无符号：</p>
<table>
<thead>
<tr>
<th>自定义</th>
<th>字节</th>
</tr>
</thead>
<tbody>
<tr>
<td>Elf_Byte</td>
<td>1</td>
</tr>
<tr>
<td>Elf64_Quarter</td>
<td>2</td>
</tr>
<tr>
<td>Elf64_Half</td>
<td>4</td>
</tr>
<tr>
<td>Elf64_Word</td>
<td>4</td>
</tr>
<tr>
<td>Elf64_Addr</td>
<td>8</td>
</tr>
<tr>
<td>Elf64_Off</td>
<td>8</td>
</tr>
<tr>
<td>Elf64_Xword</td>
<td>8</td>
</tr>
</tbody>
</table>
<p>有符号：</p>
<table>
<thead>
<tr>
<th>自定义</th>
<th>字节</th>
</tr>
</thead>
<tbody>
<tr>
<td>Elf64_Shalf</td>
<td>4</td>
</tr>
<tr>
<td>Elf64_Sword</td>
<td>4</td>
</tr>
<tr>
<td>Elf64_Sxword</td>
<td>8</td>
</tr>
</tbody>
</table>
<p>不管平台如何，x86还是arm。linux还是win。编译或者加载64位elf的时候ELF文件都是按这个类型大小定义的。因此只要保证头文件数据类型的大小一致性就能移植编译使用<br>该字长由ELF自己定义，与主机无关</p>
<p>ELF的字符集采用ASCII，支持其它编码格式</p>
<h1 id="ELF文件头-1"><a href="#ELF文件头-1" class="headerlink" title="ELF文件头"></a>ELF文件头</h1><p>文件头描述整个文件的结构信息，描述可能与文件中实际不同，具体处理需要参考具体实现源码-linker与exec。加壳时寻找其bug<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#define EI_NIDENT	16		/* Size of e_ident[] */</div><div class="line">typedef struct &#123;</div><div class="line">	unsigned char	e_ident[EI_NIDENT];	/* Id bytes */</div><div class="line">	Elf64_Quarter	e_type;			/* file type */</div><div class="line">	Elf64_Quarter	e_machine;		/* machine type */</div><div class="line">	Elf64_Half	e_version;		/* version number */</div><div class="line">	Elf64_Addr	e_entry;		/* entry point */</div><div class="line">	Elf64_Off	e_phoff;		/* Program hdr offset */</div><div class="line">	Elf64_Off	e_shoff;		/* Section hdr offset */</div><div class="line">	Elf64_Half	e_flags;		/* Processor flags */</div><div class="line">	Elf64_Quarter	e_ehsize;		/* sizeof ehdr */</div><div class="line">	Elf64_Quarter	e_phentsize;		/* Program header entry size */</div><div class="line">	Elf64_Quarter	e_phnum;		/* Number of program headers */</div><div class="line">	Elf64_Quarter	e_shentsize;		/* Section header entry size */</div><div class="line">	Elf64_Quarter	e_shnum;		/* Number of section headers */</div><div class="line">	Elf64_Quarter	e_shstrndx;		/* String table index */</div><div class="line">&#125; Elf64_Ehdr;</div></pre></td></tr></table></figure></p>
<h2 id="ident"><a href="#ident" class="headerlink" title="ident"></a>ident</h2><p>前16个字节用于识别最基本的意义。<br>ELF文件开始的这一部分的格式是固定并通用的，在所有平台上都一样。 所有处理器都可能用固定的格式去读取这一部分的内容，从而获知这个 ELF文件 中接下来的内容应该如何读取和解析。 </p>
<p>定义ident数组索引功能的宏：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">//e_ident[] identification indexes</div><div class="line">#define EI_MAG0		0		/* file ID 文件标志*/</div><div class="line">#define EI_MAG1		1		/* file ID */</div><div class="line">#define EI_MAG2		2		/* file ID */</div><div class="line">#define EI_MAG3		3		/* file ID */</div><div class="line">#define EI_CLASS	4		/* file class 文件类别*/</div><div class="line">#define EI_DATA		5		/* data encoding 编码格式*/</div><div class="line">#define EI_VERSION	6		/* ELF header version 文件版本*/</div><div class="line">#define EI_OSABI	7		/* OS/ABI ID */</div><div class="line">#define EI_ABIVERSION	8		/* ABI version */ </div><div class="line">#define EI_PAD		9		/* start of pad bytes 补齐*/</div><div class="line">#define EI_NIDENT	16		/* Size of e_ident[] */</div></pre></td></tr></table></figure></p>
<h3 id="MAG0-3"><a href="#MAG0-3" class="headerlink" title="MAG0-3"></a>MAG0-3</h3><p>魔数部分，用于标识ELF文件，这四个字节内容固定<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> /* e_ident[] magic number */</div><div class="line">#define	ELFMAG0		0x7f		/* e_ident[EI_MAG0] */</div><div class="line">#define	ELFMAG1		&apos;E&apos;		/* e_ident[EI_MAG1] */</div><div class="line">#define	ELFMAG2		&apos;L&apos;		/* e_ident[EI_MAG2] */</div><div class="line">#define	ELFMAG3		&apos;F&apos;		/* e_ident[EI_MAG3] */</div><div class="line">#define	ELFMAG		&quot;\177ELF&quot;	/* magic */</div><div class="line">#define	SELFMAG		4		/* size of magic */</div></pre></td></tr></table></figure></p>
<p>实际结果就是这个</p>
<h3 id="CLASS"><a href="#CLASS" class="headerlink" title="CLASS"></a>CLASS</h3><p>这个字节用于指明文件的类型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">/* e_ident[] file class */</div><div class="line">#define	ELFCLASSNONE	0		/* invalid */</div><div class="line">#define	ELFCLASS32	1		/* 32-bit objs */</div><div class="line">#define	ELFCLASS64	2		/* 64-bit objs */</div><div class="line">#define	ELFCLASSNUM	3		/* number of classes 这里可选的种类数*/</div></pre></td></tr></table></figure></p>
<p>实际结果为2</p>
<h3 id="DATA"><a href="#DATA" class="headerlink" title="DATA"></a>DATA</h3><p>指明了目标文件中的数据编码格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">/* e_ident[] data encoding */</div><div class="line">#define ELFDATANONE	0		/* invalid */</div><div class="line">#define ELFDATA2LSB	1		/* Little-Endian */</div><div class="line">#define ELFDATA2MSB	2		/* Big-Endian */</div><div class="line">#define ELFDATANUM	3		/* number of data encode defines 可选种类数*/</div></pre></td></tr></table></figure></p>
<p>决定大端小端的。<br>实际为小端，因此arm64下android原生为小端编码-方便与机器</p>
<h3 id="VERSION"><a href="#VERSION" class="headerlink" title="VERSION"></a>VERSION</h3><p>指明 ELF文件头的版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">typedef enum &lt;uchar&gt; &#123;</div><div class="line">    E_NONE      = 0x0,</div><div class="line">    E_CURRENT   = 0x1,</div><div class="line">    E_NUM       = 0x2</div><div class="line">&#125; ei_version_e;</div></pre></td></tr></table></figure></p>
<p>current:当前<br>实际为1</p>
<h3 id="OSABI"><a href="#OSABI" class="headerlink" title="OSABI"></a>OSABI</h3><p>指明可运行的ABI<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/* e_ident[] Operating System/ABI */</div><div class="line">#define ELFOSABI_SYSV		0	/* UNIX System V ABI */</div><div class="line">#define ELFOSABI_HPUX		1	/* HP-UX operating system */</div><div class="line">#define ELFOSABI_NETBSD		2	/* NetBSD */</div><div class="line">#define ELFOSABI_LINUX		3	/* GNU/Linux */</div><div class="line">#define ELFOSABI_HURD		4	/* GNU/Hurd */</div><div class="line">#define ELFOSABI_86OPEN		5	/* 86Open common IA32 ABI */</div><div class="line">#define ELFOSABI_SOLARIS	6	/* Solaris */</div><div class="line">#define ELFOSABI_MONTEREY	7	/* Monterey */</div><div class="line">#define ELFOSABI_IRIX		8	/* IRIX */</div><div class="line">#define ELFOSABI_FREEBSD	9	/* FreeBSD */</div><div class="line">#define ELFOSABI_TRU64		10	/* TRU64 UNIX */</div><div class="line">#define ELFOSABI_MODESTO	11	/* Novell Modesto */</div><div class="line">#define ELFOSABI_OPENBSD	12	/* OpenBSD */</div><div class="line">#define ELFOSABI_ARM		97	/* ARM */</div><div class="line">#define ELFOSABI_STANDALONE	255	/* Standalone (embedded) application */</div></pre></td></tr></table></figure></p>
<p>实际并没使用…为0</p>
<h3 id="ABIVERSION"><a href="#ABIVERSION" class="headerlink" title="ABIVERSION"></a>ABIVERSION</h3><p>实际为0</p>
<h3 id="PAD"><a href="#PAD" class="headerlink" title="PAD"></a>PAD</h3><p>从 e-ident[EI-PAD]到 e-ident[EI-NIDENT-1]之间的7个字节目前暂时不使 用，留作以后扩展，在实际的文件中应被填 0补充，其它程序在读取 ELF文 件头时应该忽略这些字节。如果以后 ELF文件头的内容被扩展，这 9个字节 中有一些被使用起来的话，EI_PAD将被定义得更大</p>
<h2 id="type"><a href="#type" class="headerlink" title="type"></a>type</h2><p>此字段表明本目标文件属于哪种类型。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">/* e_type */</div><div class="line">#define ET_NONE		0		/* No file type */</div><div class="line">#define ET_REL		1		/* relocatable file 可重定位文件*/</div><div class="line">#define ET_EXEC		2		/* executable file 可执行文件*/</div><div class="line">#define ET_DYN		3		/* shared object file 动态连接库文件*/</div><div class="line">#define ET_CORE		4		/* core file core文件*/</div><div class="line">#define ET_NUM		5		/* number of types 种类的数量*/</div><div class="line">#define ET_LOPROC	0xff00		/* reserved range for processor 特定处理器文件扩展下边界*/</div><div class="line">#define ET_HIPROC	0xffff		/*  specific e_type 特定处理器扩展上边界*/</div></pre></td></tr></table></figure></p>
<p>ET-LOPROC ~ ET-HIPROC (0xff00 ~ 0xffff)这一范围内的文件类型是为特定 处理器而保留的，如果需要为某种处理器专门设定文件格式，可以从这一范围内选 取一个做为标识。<br>在以上已定义范围外的文件类型均为保留类型，留做以后可能的扩展。</p>
<p>这个实际上arm64android下不管so还是加不加pie的可执行文件都是3</p>
<h2 id="machine"><a href="#machine" class="headerlink" title="machine"></a>machine</h2><p>此字段用于指定该文件适用的处理器体系结构<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">/* e_machine */</div><div class="line">#define EM_NONE		0		/* No Machine */</div><div class="line">#define EM_M32		1		/* AT&amp;T WE 32100 */</div><div class="line">#define EM_SPARC	2		/* SPARC */</div><div class="line">#define EM_386		3		/* Intel 80386 */</div><div class="line">#define EM_68K		4		/* Motorola 68000 */</div><div class="line">#define EM_88K		5		/* Motorola 88000 */</div><div class="line">#define EM_486		6		/* Intel 80486 - unused? */</div><div class="line">#define EM_860		7		/* Intel 80860 */</div><div class="line">#define EM_MIPS		8		/* MIPS R3000 Big-Endian only */</div><div class="line">/*</div><div class="line"> * Don&apos;t know if EM_MIPS_RS4_BE,</div><div class="line"> * EM_SPARC64, EM_PARISC,</div><div class="line"> * or EM_PPC are ABI compliant</div><div class="line"> */</div><div class="line">#define EM_MIPS_RS4_BE	10		/* MIPS R4000 Big-Endian */</div><div class="line">#define EM_SPARC64	11		/* SPARC v9 64-bit unoffical */</div><div class="line">#define EM_PARISC	15		/* HPPA */</div><div class="line">#define EM_SPARC32PLUS	18		/* Enhanced instruction set SPARC */</div><div class="line">#define EM_PPC		20		/* PowerPC */</div><div class="line">#define EM_ARM		40		/* Advanced RISC Machines ARM */</div><div class="line">#define EM_ALPHA	41		/* DEC ALPHA */</div><div class="line">#define EM_SPARCV9	43		/* SPARC version 9 */</div><div class="line">#define EM_ALPHA_EXP	0x9026		/* DEC ALPHA */</div><div class="line">#define EM_AMD64	62		/* AMD64 architecture */</div><div class="line">#define EM_VAX		75		/* DEC VAX */</div><div class="line">#define EM_NUM		15		/* number of machine types */</div></pre></td></tr></table></figure></p>
<p>实际这里的值是B7。应该是android自己定的…</p>
<h2 id="version"><a href="#version" class="headerlink" title="version"></a>version</h2><p>此字段指明目标文件的版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> /* Version */</div><div class="line">#define EV_NONE		0		/* Invalid */</div><div class="line">#define EV_CURRENT	1		/* Current */</div><div class="line">#define EV_NUM		2		/* number of versions */</div></pre></td></tr></table></figure></p>
<p>实际为1，可以根据目标文件的版本变动</p>
<h2 id="entry"><a href="#entry" class="headerlink" title="entry"></a>entry</h2><p>指明程序入口的虚拟地址，对于非可执行文件该值为0</p>
<p>实际上so与可执行都有这个值…用ida分析后发现该值指向的文件偏移量就是start函数地址。<br>文件中的虚拟地址应该都是相对文件0的偏移。</p>
<h2 id="phoff"><a href="#phoff" class="headerlink" title="phoff"></a>phoff</h2><p>此字段指明程序头表(program header table)开始处在文件中的偏移量。如果没 有程序头表，该值应设为 0<br>这些偏移都是从0开始的，并且偏移处就是开始。如果把整个文件看成数组，file[off]就是目标的开始第一个字节，说成数组/文件的第几个字节就是off+1<br>数数从1开始数，数组从0开始标</p>
<h2 id="shoff"><a href="#shoff" class="headerlink" title="shoff"></a>shoff</h2><p>此字段指明节头表(section header table)开始处在文件中的偏移量。如果没有节头表，该值应设为 0。 </p>
<h2 id="flags"><a href="#flags" class="headerlink" title="flags"></a>flags</h2><p>此字段含有处理器特定的标志位。标志的名字符合”EF-machine-flag”的格式。<br>实际为0</p>
<h2 id="ehsize"><a href="#ehsize" class="headerlink" title="ehsize"></a>ehsize</h2><p>此字段表明 ELF文件头的大小，以字节为单位。 </p>
<h2 id="phentsize"><a href="#phentsize" class="headerlink" title="phentsize"></a>phentsize</h2><p>此字段表明在程序头表中每一个表项的大小，以字节为单位。 </p>
<h2 id="phnum"><a href="#phnum" class="headerlink" title="phnum"></a>phnum</h2><p>此字段表明程序头表中总共有多少个表项。如果一个目标文件中没有程序头 表，该值应设为 0</p>
<h2 id="shentsize"><a href="#shentsize" class="headerlink" title="shentsize"></a>shentsize</h2><p>此字段表明在节头表中每一个表项的大小，以字节为单位。 </p>
<h2 id="shnum"><a href="#shnum" class="headerlink" title="shnum"></a>shnum</h2><p>此字段表明节头表中总共有多少个表项。如果一个目标文件中没有节头表， 该值应设为 0</p>
<h2 id="shstrndx"><a href="#shstrndx" class="headerlink" title="shstrndx"></a>shstrndx</h2><p>节头表中与节名字表相对应的表项的索引。如果文件没有节名字表，此值应 设置为 SHN-UNDEF。<br>这个就是节名字表在节表的下标</p>
<h1 id="节"><a href="#节" class="headerlink" title="节"></a>节</h1><h2 id="节头表"><a href="#节头表" class="headerlink" title="节头表"></a>节头表</h2><p>在目标文件中可以包含很多“节”(section)，所有这些“节”都登记在一张称为 “节头表”(section header table)的数组里。节头表的每一个表项是一个 Elf64-Shdr 结构，通过每一个表项可以定位到对应的节</p>
<p>elf文件头中给出了其表头位置、表项数量、表项大小</p>
<p>某些表项的索引值被保留，有特殊的含义。ELF文件的节头表中不会出现索引值为以下各值的表项<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/* Special Section Indexes */</div><div class="line">#define SHN_UNDEF	0		/* undefined 它表示一个未定义的、不存在的节的索引。 */</div><div class="line">#define SHN_LORESERVE	0xff00		/* lower bounds of reserved indexes 被保留索引号区间的下限。*/</div><div class="line">#define SHN_LOPROC	0xff00		/* reserved range for processor 为处理器定制节所保留的索引号区间的下限。 */</div><div class="line">#define SHN_HIPROC	0xff1f		/*   specific section indexes 为处理器定制节所保留的索引号区间的上限。 */</div><div class="line">#define SHN_ABS		0xfff1		/* absolute value 此节中所定义的符号有绝对的值，这个值不会因重定位而改变。*/</div><div class="line">#define SHN_COMMON	0xfff2		/* common symbol 此节中所定义的符号是公共的，比如 FORTRAN COMMON符号或者未分配的C外部变量。*/</div><div class="line">#define SHN_HIRESERVE	0xffff		/* upper bounds of reserved indexes 被保留索引号区间的上限*/</div></pre></td></tr></table></figure></p>
<p>通常，目标文件中含有众多的“节”，“节”区是文件中大的部分，它们需要满足下列这些条件： </p>
<ol>
<li>目标文件中的每一个节一定对应有一个节头(section header)，节头中有对节的描述信息；但有的节头可以没有对应的节，而只是一个空的头。 </li>
<li>每一个节所占用的空间是连续的。 </li>
<li>各个节之间不能互相重叠。 </li>
<li>在目标文件中，节与节之间可能会存在一些多余的字节，这些字节不属于任何节。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">typedef struct &#123;</div><div class="line">	Elf64_Half	sh_name;	/* section name */</div><div class="line">	Elf64_Half	sh_type;	/* section type */</div><div class="line">	Elf64_Xword	sh_flags;	/* section flags */</div><div class="line">	Elf64_Addr	sh_addr;	/* virtual address */</div><div class="line">	Elf64_Off	sh_offset;	/* file offset */</div><div class="line">	Elf64_Xword	sh_size;	/* section size */</div><div class="line">	Elf64_Half	sh_link;	/* link to another */</div><div class="line">	Elf64_Half	sh_info;	/* misc info */</div><div class="line">	Elf64_Xword	sh_addralign;	/* memory alignment */</div><div class="line">	Elf64_Xword	sh_entsize;	/* table entry size */</div><div class="line">&#125; Elf64_Shdr;</div></pre></td></tr></table></figure>
<h3 id="name"><a href="#name" class="headerlink" title="name"></a>name</h3><p>本节的名字。整个名字的字符串并不存储在这里，它仅是一个索引号，指向 “字符串表”节中的某个位置，那里存储了一个以’\0’结尾的字符串</p>
<p>有一些定义好的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">/* Section names */</div><div class="line">#define ELF_BSS         &quot;.bss&quot;		/* uninitialized data */</div><div class="line">#define ELF_DATA        &quot;.data&quot;		/* initialized data */</div><div class="line">#define ELF_DEBUG       &quot;.debug&quot;	/* debug */</div><div class="line">#define ELF_DYNAMIC     &quot;.dynamic&quot;	/* dynamic linking information */</div><div class="line">#define ELF_DYNSTR      &quot;.dynstr&quot;	/* dynamic string table */</div><div class="line">#define ELF_DYNSYM      &quot;.dynsym&quot;	/* dynamic symbol table */</div><div class="line">#define ELF_FINI        &quot;.fini&quot;		/* termination code */</div><div class="line">#define ELF_GOT         &quot;.got&quot;		/* global offset table */</div><div class="line">#define ELF_HASH        &quot;.hash&quot;		/* symbol hash table */</div><div class="line">#define ELF_INIT        &quot;.init&quot;		/* initialization code */</div><div class="line">#define ELF_REL_DATA    &quot;.rel.data&quot;	/* relocation data */</div><div class="line">#define ELF_REL_FINI    &quot;.rel.fini&quot;	/* relocation termination code */</div><div class="line">#define ELF_REL_INIT    &quot;.rel.init&quot;	/* relocation initialization code */</div><div class="line">#define ELF_REL_DYN     &quot;.rel.dyn&quot;	/* relocaltion dynamic link info */</div><div class="line">#define ELF_REL_RODATA  &quot;.rel.rodata&quot;	/* relocation read-only data */</div><div class="line">#define ELF_REL_TEXT    &quot;.rel.text&quot;	/* relocation code */</div><div class="line">#define ELF_RODATA      &quot;.rodata&quot;	/* read-only data */</div><div class="line">#define ELF_SHSTRTAB    &quot;.shstrtab&quot;	/* section header string table */</div><div class="line">#define ELF_STRTAB      &quot;.strtab&quot;	/* string table */</div><div class="line">#define ELF_SYMTAB      &quot;.symtab&quot;	/* symbol table */</div><div class="line">#define ELF_TEXT        &quot;.text&quot;		/* code */</div></pre></td></tr></table></figure></p>
<p>功能见下特殊节</p>
<h3 id="type-1"><a href="#type-1" class="headerlink" title="type"></a>type</h3><p>本节的类型。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">/* sh_type */</div><div class="line">#define SHT_NULL	0		/* inactive */</div><div class="line">#define SHT_PROGBITS	1		/* program defined information */</div><div class="line">#define SHT_SYMTAB	2		/* symbol table section */</div><div class="line">#define SHT_STRTAB	3		/* string table section */</div><div class="line">#define SHT_RELA	4		/* relocation section with addends*/</div><div class="line">#define SHT_HASH	5		/* symbol hash table section */</div><div class="line">#define SHT_DYNAMIC	6		/* dynamic section */</div><div class="line">#define SHT_NOTE	7		/* note section */</div><div class="line">#define SHT_NOBITS	8		/* no space section */</div><div class="line">#define SHT_REL		9		/* relation section without addends */</div><div class="line">#define SHT_SHLIB	10		/* reserved - purpose unknown */</div><div class="line">#define SHT_DYNSYM	11		/* dynamic symbol table section */</div><div class="line">#define SHT_NUM		12		/* number of section types 节种类的数量 */</div><div class="line">#define SHT_LOPROC	0x70000000	/* reserved range for processor */</div><div class="line">#define SHT_HIPROC	0x7fffffff	/*  specific section header types */</div><div class="line">#define SHT_LOUSER	0x80000000	/* reserved range for application */</div><div class="line">#define SHT_HIUSER	0xffffffff	/*  specific indexes */</div></pre></td></tr></table></figure></p>
<p>0号的表头项不表达实际的内容，只是一个空的表项</p>
<h4 id="NULL"><a href="#NULL" class="headerlink" title="NULL"></a>NULL</h4><p>此值表明本节头是一个无效的（非活动的）节头，它也没有对应的节。本节头中的其它成员的值也都是没有意义的。</p>
<h4 id="PROGBITS"><a href="#PROGBITS" class="headerlink" title="PROGBITS"></a>PROGBITS</h4><p>此值表明本节所含有的信息是由程序定义的，本节内容的格式和含义都由程序来决定。</p>
<h4 id="SYMTAB"><a href="#SYMTAB" class="headerlink" title="SYMTAB"></a>SYMTAB</h4><p>静态符号表<br>一般来说，SHT_SYMTAB提供的符号用于在创建目标文件的时候编辑连接，在运行期间也有可能会用于动态连接。SHT-SYMTAB包含完整的符号表，它往往会包含很多在运行期间(动态连接)用不到的符号。所以一个目标文件可以再有一个 SHT_DYNSYM节，它含有一个较小的符号表，专门用于动态连接。 </p>
<h4 id="STRTAB"><a href="#STRTAB" class="headerlink" title="STRTAB"></a>STRTAB</h4><p>此值表明本节是字符串表。目标文件中可以包含多个字符串表节。 </p>
<h4 id="RELA"><a href="#RELA" class="headerlink" title="RELA"></a>RELA</h4><p>重定位节，含加数</p>
<h4 id="HASH"><a href="#HASH" class="headerlink" title="HASH"></a>HASH</h4><p>哈希表，连接使用，便于快速找到符号</p>
<h4 id="DYNAMIC"><a href="#DYNAMIC" class="headerlink" title="DYNAMIC"></a>DYNAMIC</h4><p>动态连接信息的节</p>
<h4 id="NOTE"><a href="#NOTE" class="headerlink" title="NOTE"></a>NOTE</h4><p>此值表明本节包含的信息用于以某种方式来标记本文件。 </p>
<h4 id="NOBITS"><a href="#NOBITS" class="headerlink" title="NOBITS"></a>NOBITS</h4><p>此值表明这一节的内容是空的，节并不占用实际的文件空间。</p>
<h4 id="REL"><a href="#REL" class="headerlink" title="REL"></a>REL</h4><p>重定位节，不含加数</p>
<h4 id="SHLIB"><a href="#SHLIB" class="headerlink" title="SHLIB"></a>SHLIB</h4><p>保留值，未定义</p>
<h4 id="DYNSYM"><a href="#DYNSYM" class="headerlink" title="DYNSYM"></a>DYNSYM</h4><p>动态符号表</p>
<h4 id="LOPROC"><a href="#LOPROC" class="headerlink" title="LOPROC"></a>LOPROC</h4><p>为特殊处理器保留的节类型索引值的下边界。 </p>
<h4 id="HIPROC"><a href="#HIPROC" class="headerlink" title="HIPROC"></a>HIPROC</h4><p>为特殊处理器保留的节类型索引值的上边界。</p>
<h4 id="LOUSER"><a href="#LOUSER" class="headerlink" title="LOUSER"></a>LOUSER</h4><p>为应用程序保留节类型索引值的下边界。 </p>
<h4 id="HIUSER"><a href="#HIUSER" class="headerlink" title="HIUSER"></a>HIUSER</h4><p>为应用程序保留节类型索引值的下边界。</p>
<h3 id="flags-1"><a href="#flags-1" class="headerlink" title="flags"></a>flags</h3><p>本节的一些属性，由一系列标志比特位组成，各个比特定义了节的不同属性，当某种属性被设置时相应的标志位被设为1，反之则设为0。未定义的标志位被全部置0。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/* Section Attribute Flags - sh_flags */</div><div class="line">#define SHF_WRITE	0x1		/* Writable */</div><div class="line">#define SHF_ALLOC	0x2		/* occupies memory */</div><div class="line">#define SHF_EXECINSTR	0x4		/* executable */</div><div class="line">#define SHF_MASKPROC	0xf0000000	/* reserved bits for processor */</div><div class="line">					/*  specific section attributes */</div></pre></td></tr></table></figure>
<h4 id="WRITE"><a href="#WRITE" class="headerlink" title="WRITE"></a>WRITE</h4><p>如果此标志被设置，表示本节所包含的内容在进程运行过程中是可写的</p>
<h4 id="ALLOC"><a href="#ALLOC" class="headerlink" title="ALLOC"></a>ALLOC</h4><p>如果此标志被设置，表示本节内容在进程运行过程中要占用内存单元。并不是所有节都会占用实际的内存，有一些起控制作用的节，在目标文件映射到进程空间时，并不需要占用内存。 </p>
<h4 id="EXECINSTR"><a href="#EXECINSTR" class="headerlink" title="EXECINSTR"></a>EXECINSTR</h4><p>如果此标志被设置，表示此节内容是指令代码。 </p>
<h4 id="MASKPROC"><a href="#MASKPROC" class="headerlink" title="MASKPROC"></a>MASKPROC</h4><p>所有被此值所覆盖的位都是保留做特殊处理器扩展用的。 </p>
<h3 id="addr"><a href="#addr" class="headerlink" title="addr"></a>addr</h3><p>如果本节的内容需要映射到进程空间中去，此成员指定映射的起始地址；如果不需要映射，此值为0。<br>即指定虚拟地址。<br>实际上该值和文件偏移可能一样可能不同，但该值也是相对基址0的，在虚拟地址中可以相对装入，在文件中节连续但在内存中节之间可能留有很大空隙</p>
<h3 id="offset"><a href="#offset" class="headerlink" title="offset"></a>offset</h3><p>指明了本节所在的位置，该值是节的第一个字节在文件中的位置，即相对于文件开头的偏移量。单位是字节。如果该节的类型为 SHT-NOBITS的话，表明这一节的内容是空的，节并不占用实际的空间，这时 sh_offset只代表一个逻辑上的位置概念，并不代表实际的内容。</p>
<h3 id="size"><a href="#size" class="headerlink" title="size"></a>size</h3><p>指明节的大小，单位是字节。如果该节的类型为 SHT-NOBITS，此值仍然可能为非零，但没有实际的意义。<br>指明的是该节在内存与文件中的大小，但是可被 NOBITS表示为仅指明内存中的大小。</p>
<h3 id="link"><a href="#link" class="headerlink" title="link"></a>link</h3><p>此成员是一个索引值，指向节头表中本节所对应的位置。根据节的类型不同，本成员的意义也有所不同。</p>
<h3 id="info"><a href="#info" class="headerlink" title="info"></a>info</h3><p>此成员含有此节的附加信息，根据节的类型不同，本成员的意义也有所不同<br>对于某些节类型来说，sh-link和 sh-info含有特殊的信息：<br><img src="https://i.imgur.com/Cc6dCwQ.png" alt=""></p>
<h3 id="addralign"><a href="#addralign" class="headerlink" title="addralign"></a>addralign</h3><p>此成员指明本节内容如何对齐字节，即该节的地址应该向多少个字节对齐。<br>保证addr%(2<em> </em>addralign )=0  为0或1表示没有对齐要求</p>
<h3 id="entsize"><a href="#entsize" class="headerlink" title="entsize"></a>entsize</h3><p>有一些节的内容是一张表，其中每一个表项的大小是固定的，比如符号表。对于这种表来说，本成员指定其每一个表项的大小。如果此值为 0则表明本节内容不是这种表格</p>
<h2 id="特殊节"><a href="#特殊节" class="headerlink" title="特殊节"></a>特殊节</h2><p>在ELF文件中有一些特定的节是预定义好的，其内容是指令代码或者控制信息。这些节专门为操作系统使用，对于不同的操作系统，这些节的类型和属性有所不同。<br>.开头表示为系统保留的。应用程序可以构造自己的节，但最好不要重名。节名不具有唯一性，可以重复。</p>
<p>比如但不限于：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">/* Section names */</div><div class="line">#define ELF_BSS         &quot;.bss&quot;		/* uninitialized data */</div><div class="line">#define ELF_DATA        &quot;.data&quot;		/* initialized data */</div><div class="line">#define ELF_DEBUG       &quot;.debug&quot;	/* debug */</div><div class="line">#define ELF_DYNAMIC     &quot;.dynamic&quot;	/* dynamic linking information */</div><div class="line">#define ELF_DYNSTR      &quot;.dynstr&quot;	/* dynamic string table */</div><div class="line">#define ELF_DYNSYM      &quot;.dynsym&quot;	/* dynamic symbol table */</div><div class="line">#define ELF_FINI        &quot;.fini&quot;		/* termination code */</div><div class="line">#define ELF_GOT         &quot;.got&quot;		/* global offset table */</div><div class="line">#define ELF_HASH        &quot;.hash&quot;		/* symbol hash table */</div><div class="line">#define ELF_INIT        &quot;.init&quot;		/* initialization code */</div><div class="line">#define ELF_REL_DATA    &quot;.rel.data&quot;	/* relocation data */</div><div class="line">#define ELF_REL_FINI    &quot;.rel.fini&quot;	/* relocation termination code */</div><div class="line">#define ELF_REL_INIT    &quot;.rel.init&quot;	/* relocation initialization code */</div><div class="line">#define ELF_REL_DYN     &quot;.rel.dyn&quot;	/* relocaltion dynamic link info */</div><div class="line">#define ELF_REL_RODATA  &quot;.rel.rodata&quot;	/* relocation read-only data */</div><div class="line">#define ELF_REL_TEXT    &quot;.rel.text&quot;	/* relocation code */</div><div class="line">#define ELF_RODATA      &quot;.rodata&quot;	/* read-only data */</div><div class="line">#define ELF_SHSTRTAB    &quot;.shstrtab&quot;	/* section header string table */</div><div class="line">#define ELF_STRTAB      &quot;.strtab&quot;	/* string table */</div><div class="line">#define ELF_SYMTAB      &quot;.symtab&quot;	/* symbol table */</div><div class="line">#define ELF_TEXT        &quot;.text&quot;		/* code */</div></pre></td></tr></table></figure></p>
<h3 id="bss"><a href="#bss" class="headerlink" title="bss"></a>bss</h3><p>本节中包含目标文件中未初始化的全局变量。一般情况下，可执行程序在开始运行的时候，系统会把这一段内容清零。但是，在运行期间的 bss段是由系统初始化而成的，在目标文件中.bss节并不包含任何内容，其长度为 0，所以它的节类型为 SHT-NOBITS。<br>其也指明了size<br><img src="https://i.imgur.com/RVRaTEv.png" alt=""></p>
<h3 id="comment"><a href="#comment" class="headerlink" title="comment"></a>comment</h3><p>版本控制信息<br><img src="https://i.imgur.com/MNYcFJH.png" alt=""></p>
<p>可见其中包含了编译器信息，没有alloc表示不在内存中分配空间</p>
<h3 id="data-data1"><a href="#data-data1" class="headerlink" title="data/data1"></a>data/data1</h3><p>这两个节用于存放程序中被初始化过的全局变量。在目标文件中，它们是占用实际的存储空间的，与.bss节不同。<br><img src="https://i.imgur.com/TqEDYFo.png" alt=""></p>
<h3 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h3><p>本节中含有调试信息，内容格式没有统一规定。所有以”.debug”为前缀的节名 字都是保留的</p>
<h3 id="dynamic"><a href="#dynamic" class="headerlink" title="dynamic"></a>dynamic</h3><p>本节包含动态连接信息，并且可能有 SHF-ALLOC和 SHF-WRITE等属性。 是否具有SHF-WRITE属性取决于操作系统和处理器。<br>保存了动态连接的基本信息，依赖对象、动态连接符号表、动态连接重定位表等</p>
<p><img src="https://i.imgur.com/31RrnM4.png" alt=""></p>
<h3 id="dynstr"><a href="#dynstr" class="headerlink" title="dynstr"></a>dynstr</h3><p>此节含有用于动态连接的字符串，一般是那些与符号表相关的名字。</p>
<p><img src="https://i.imgur.com/8l2Ps0C.png" alt=""></p>
<p>里面含有动态连接符号的字串</p>
<h3 id="dynsym"><a href="#dynsym" class="headerlink" title="dynsym"></a>dynsym</h3><p>此节含有动态连接符号表<br><img src="https://i.imgur.com/SsFfAQE.png" alt=""></p>
<h3 id="fini"><a href="#fini" class="headerlink" title="fini"></a>fini</h3><p>此节包含进程终止时要执行的程序指令。当程序正常退出时，系统会执行这一节中的代码。</p>
<h3 id="got"><a href="#got" class="headerlink" title="got"></a>got</h3><p>此节包含全局偏移量表。 </p>
<h3 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h3><p>本节包含一张符号哈希表。 </p>
<h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><p>此节包含进程初始化时要执行的程序指令。当程序开始运行时，系统会在进 入主函数之前执行这一节中的代码。so中含有也会用于初始化</p>
<h3 id="interp"><a href="#interp" class="headerlink" title="interp"></a>interp</h3><p>此节含有 ELF程序解析器的路径名。如果此节被包含在某个可装载的段中，那么本节的属性中应置 SHF-ALLOC标志位，否则不置此标志</p>
<h3 id="line"><a href="#line" class="headerlink" title="line"></a>line</h3><p>本节也是一个用于调试的节，它包含那些调试符号的行号，为程序指令码与源文件的行号建立起联系。其内容格式没有统一规定。</p>
<h3 id="note"><a href="#note" class="headerlink" title="note"></a>note</h3><p>注释节</p>
<h3 id="plt"><a href="#plt" class="headerlink" title="plt"></a>plt</h3><p>函数连接表</p>
<h3 id="relname-relaname"><a href="#relname-relaname" class="headerlink" title="relname/relaname"></a>relname/relaname</h3><p>这两个节含有重定位信息。如果此节被包含在某个可装载的段中，那么本节的属性中应置 SHF-ALLOC标志位，否则不置此标志。注意，这两个节的名字 中”name”是可替换的部分，执照惯例，对哪一节做重定位就把”name”换成哪一节 的名字。比如，.text节的重定位节的名字将是.rel.text或.rela.text。 </p>
<p>重定位是把符号引用和符号定义连接在一起的过程。使程序知道该跳转到哪里去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">typedef struct &#123;</div><div class="line">	Elf64_Xword	r_offset;	/* where to do it */</div><div class="line">	Elf64_Xword	r_info;		/* index &amp; type of relocation */</div><div class="line">&#125; Elf64_Rel;</div><div class="line"></div><div class="line">typedef struct &#123;</div><div class="line">	Elf64_Xword	r_offset;	/* where to do it */</div><div class="line">	Elf64_Xword	r_info;		/* index &amp; type of relocation */</div><div class="line">	Elf64_Sxword	r_addend;	/* adjustment value */</div><div class="line">&#125; Elf64_Rela;</div></pre></td></tr></table></figure>
<p>一个“重定位节(relocation section)”需要引用另外两个节：一个是符号表节，一个是被修改节。在重定位节中，节头的sh-info和 sh-link成员分别指明了引用关系。不同的目标文件中，重定位项的r-offset成员的含义略有不同。 </p>
<ol>
<li>在重定位文件中，r-offset成员含有一个节偏移量。也就是说，重定位节本身描述的是如何修改文件中的另一个节的内容，重定位偏移量 (r-offset)指向了另一个节中的一个存储单元地址。</li>
<li>在可执行文件或共享目标文件中，r-offset含有的是符号定义在进程空间中的虚拟地址。可执行文件和共享目标文件是用于运行程序而不是构建程序的，所以对它们来说更有用的信息是运行期的内存虚拟地址，而不是某个符号定义在文件中的位置。 </li>
</ol>
<p>表明了从哪个符号表找到符号去哪里如何修改地址</p>
<h4 id="offset-1"><a href="#offset-1" class="headerlink" title="offset"></a>offset</h4><p>本数据成员给出重定位所作用的位置。对于重定位文件来说，此值是受重定位作用的存储单元在节中的字节偏移量；对于可执行文件或共享目标文件来说，此值是受重定位作用的存储单元的虚拟地址。 </p>
<h4 id="info-1"><a href="#info-1" class="headerlink" title="info"></a>info</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#define	ELF64_R_SYM(info)	((info) &gt;&gt; 32)</div><div class="line">#define	ELF64_R_TYPE(info)	((info) &amp; 0xFFFFFFFF)</div><div class="line">#define ELF64_R_INFO(s,t) 	(((s) &lt;&lt; 32) + (__uint32_t)(t))</div></pre></td></tr></table></figure>
<p>低32位表示重定位类型，高32位表示重定位符号在符号表的下标。使用的符号表用link表示，作用的段用info表示<br>比如：<br>GLOB-DAT:  这种重定位类型用于把指定的符号地址设置为一个全局偏移量表项。这种重 定位类型在符号与全局偏移量表项之间建立起了联系。 </p>
<h4 id="addend"><a href="#addend" class="headerlink" title="addend"></a>addend</h4><p>本成员指定了一个加数，这个加数用于计算需要重定位的域的值</p>
<h3 id="rodata-rodata1"><a href="#rodata-rodata1" class="headerlink" title="rodata/rodata1"></a>rodata/rodata1</h3><p>本节包含程序中的只读数据，在程序装载时，它们一般会被装入进程空间中 那些只读的段中去。</p>
<h3 id="shstrtab"><a href="#shstrtab" class="headerlink" title="shstrtab"></a>shstrtab</h3><p>本节是“节名字表”，含有所有其它节的名字，属于字符串表的一种，它包含所有节的名字。每一个节头的 sh-name成员应该是一个索引值，它指向节名字表中的一个位置，从这个位置开始到接下来第一个’null’字符为止的这个字符串，正是这个节的名字。<br><img src="https://i.imgur.com/Slc8Fg9.png" alt=""></p>
<p>可见并不用分配内存空间</p>
<h3 id="strtab"><a href="#strtab" class="headerlink" title="strtab"></a>strtab</h3><p>本节用于存放字符串，主要是那些符号表项的名字。如果一个目标文件有一个可装载的段，并且其中含有符号表，那么本节的属性中应该有SHF-ALLOC。<br>以null开头，该节种存放多个以null结尾的字符序列。<br>索引时提供的序号不是字符串的序号。如果把整个字符串节看做字节数组的话该序号是数组的下标。从下标到null为被指向的字串。因此可以引用每个字符串靠后的部分。<br>实际上so与可执行中没有看见这个节，这个节一般在可重定位文件中(.o.a)</p>
<h3 id="symtab"><a href="#symtab" class="headerlink" title="symtab"></a>symtab</h3><p>本节用于存放符号表。如果一个目标文件有一个可载入的段，并且其中含有 符号表，那么本节的属性中应该有 SHF-ALLOC。<br>目标文件中的“符号表(symbol table)”所包含的信息用于定位和重定位程序中的符号<strong>定义和引用</strong>。目标文件的其它部分通过一个符号在这个表中的索引值来使用该符号。索引值从0开始计数，但值为0的表项（即第一项）并没有实际的意义，它表示未定义的符号。这里用常量STN-UNDEF来表示未定义的符号。 </p>
<p>定义：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">typedef struct &#123;</div><div class="line">	Elf64_Half	st_name;	/* Symbol name index in str table */</div><div class="line">	Elf_Byte	st_info;	/* type / binding attrs */</div><div class="line">	Elf_Byte	st_other;	/* unused */</div><div class="line">	Elf64_Quarter	st_shndx;	/* section index of symbol */</div><div class="line">	Elf64_Xword	st_value;	/* value of symbol */</div><div class="line">	Elf64_Xword	st_size;	/* size of symbol */</div><div class="line">&#125; Elf64_Sym;</div></pre></td></tr></table></figure></p>
<p>该结构体32位与64位排列不同。64位的是：411288；32位的是：444112。应该是为了保证地址对齐<br>符号表的首项全0。实际上so与可执行文件中并没有此节，该节主要用于静态连接的</p>
<h4 id="name-1"><a href="#name-1" class="headerlink" title="name"></a>name</h4><p>符号的名字。但它并不是一个字符串，而是一个指向字符串表的索引值，在字符串表中对应位置上的字符串就是该符号名字的实际文本。如果此值为非0，它代表符号名在字符串表中的索引值。如果此值为0，那么此符号无名字。 </p>
<h4 id="info-2"><a href="#info-2" class="headerlink" title="info"></a>info</h4><p>符号的类型和属性。st-info由一系列的比特位构成，标识了“符号绑定 (symbol binding)”、“符号类型(symbol type)”和“符号信息(symbol infomation)” 三种属性。下面几个宏分别用于读取这三种属性值。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#define ELF64_ST_BIND(x)	((x) &gt;&gt; 4)</div><div class="line">#define ELF64_ST_TYPE(x)	(((unsigned int) x) &amp; 0xf)</div><div class="line">#define ELF64_ST_INFO(b,t)	(((b) &lt;&lt; 4) + ((t) &amp; 0xf))//合并用</div></pre></td></tr></table></figure></p>
<h5 id="符号绑定-Symbol-Binding"><a href="#符号绑定-Symbol-Binding" class="headerlink" title="符号绑定(Symbol Binding)"></a>符号绑定(Symbol Binding)</h5><p>4位：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">/* Symbol Binding - ELF32_ST_BIND - st_info */</div><div class="line">#define STB_LOCAL	0		/* Local symbol */</div><div class="line">#define STB_GLOBAL	1		/* Global symbol */</div><div class="line">#define STB_WEAK	2		/* like global - lower precedence */</div><div class="line">#define STB_NUM		3		/* number of symbol bindings 种类数*/</div><div class="line">#define STB_LOPROC	13		/* reserved range for processor */</div><div class="line">#define STB_HIPROC	15		/*  specific symbol bindings */</div></pre></td></tr></table></figure></p>
<p><strong>LOCAL</strong><br>表明本符号是一个本地符号。它只出现在本文件中，在本文件外该符号无效。所以在不同的文件中可以定义相同的符号名，它们之间不会互相影响。</p>
<p><strong>GLOBAL</strong><br>表明本符号是一个全局符号。当有多个文件被连接在一起时，在所有文 件中该符号都是可见的。正常情况下，在一个文件中定义的全局符号，一定是在其它文件中需要被引用，否则无须定义为全局。 </p>
<p><strong>WEAK</strong><br>类似于全局符号，但是相对于STB-GLOBAL，它们的优先级更低。<br>多个可重定位文件链接时，同名的GLOBAL不许出现多次，但当GLOBAL存在时，同名弱符号可以存在但会被忽略。比其优先级高的还有COMMON符号</p>
<p><strong>LOPROC-HIPROC</strong><br>为特殊处理器保留的属性区间。</p>
<p>在符号表中，不同属性的符号所在位置也有不同，本地符号(STB-LOCAL)排在前面，全局符号(STB-GLOBAL/STB-WEAK)排在后面。 </p>
<h5 id="符号类型-Symbol-Types"><a href="#符号类型-Symbol-Types" class="headerlink" title="符号类型(Symbol Types)"></a>符号类型(Symbol Types)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">/* Symbol type - ELF32_ST_TYPE - st_info */</div><div class="line">#define STT_NOTYPE	0		/* not specified */</div><div class="line">#define STT_OBJECT	1		/* data object */</div><div class="line">#define STT_FUNC	2		/* function */</div><div class="line">#define STT_SECTION	3		/* section */</div><div class="line">#define STT_FILE	4		/* file */</div><div class="line">#define STT_NUM		5		/* number of symbol types */</div><div class="line">#define STT_LOPROC	13		/* reserved range for processor */</div><div class="line">#define STT_HIPROC	15		/*  specific symbol types */</div></pre></td></tr></table></figure>
<p><strong>NOTYPE</strong><br>本符号类型未指定。 </p>
<p><strong>OBJECT</strong><br>本符号是一个数据对象，比如变量、数组等。 </p>
<p><strong>FUNC</strong><br>本符号是一个函数，或者其它的可执行代码。函数符号在共享目标文件中有特殊的意义。当另外一个目标文件引用一个共享目标文件中的函数符号时，连接编辑器为被引用符号自动创建一个连接表项。非STT-FUNC类型的共享目标符号不会通过这种连接表项被自动引用。</p>
<p><strong>SECTION</strong><br>本符号与一个节相关联，用于重定位，通常具有STB_LOCAL属性。 </p>
<p><strong>FILE</strong><br>本符号是一个文件名符号，它具有STB-LOCAL属性，它的节索引值是 SHN-ABS。在符号表中如果存在本类符号的话，它会出现在所有 STB-LOCAL类符号的前部。</p>
<p><strong>L-H</strong><br>特殊处理器保留</p>
<h4 id="other"><a href="#other" class="headerlink" title="other"></a>other</h4><p>本数据成员目前暂未使用，在目标文件中一律赋值为 0。 </p>
<h4 id="shndx"><a href="#shndx" class="headerlink" title="shndx"></a>shndx</h4><p>任何一个符号表项的定义都与某一个“节”相联系，因为符号是为节而定义，在节中被引用。本数据成员即指明了相关联的节。本数据成员是一个索引值，它指向相关联的节在节头表中的索引。在重定位过程中，节的位置会改变，本数据成员的值也随之改变，继续指向节的新位置。<br>有三个特殊值：</p>
<h5 id="ABS"><a href="#ABS" class="headerlink" title="ABS"></a>ABS</h5><p>符号的值是绝对的，具有常量性，在重定位过程中，此值不需要改变。 </p>
<h5 id="COMMON"><a href="#COMMON" class="headerlink" title="COMMON"></a>COMMON</h5><p>本符号所关联的是一个还没有分配的公共节，本符号的值规定了其内容的字节对齐规则，与sh-addralign相似。也就是说，连接器会为本符号分配存储空间，而且其起始地址是向st-value对齐的。本符号的值指明了要分配的字节数。</p>
<h5 id="UNDEF"><a href="#UNDEF" class="headerlink" title="UNDEF"></a>UNDEF</h5><p>当一个符号指向第 1节(SHN-UNDEF)时，表明本符号在当前目标文件中未定义，在连接过程中，连接器会找到此符号被定义的文件，并把这些文件连接在一起。本文件中对该符号的引用会被连接到实际的定义上去。 </p>
<h4 id="value"><a href="#value" class="headerlink" title="value"></a>value</h4><p>符号的值。这个值其实没有固定的类型，它可能代表一个数值，也可以是一个地址，具体是什么要看上下文。</p>
<ol>
<li>在重定位文件中，如果一个符号对应的节的索引值是 SHN-COMMON，st-value值是这个节内容的字节对齐数。 </li>
<li>在重定位文件中，如果一个符号是已定义的，那么它的 st-value值 是该符号的起始地址在其所在节中的偏移量，而其所在的节的索引由st-shndx给出。</li>
<li>在可执行文件和共享库文件中，st-value不再是一个节内的偏移量，而是一个虚拟地址，直接指向符号所在的内存位置。这种情况下，st-shndx就不再需要了。 </li>
</ol>
<p>这样的设计是为了在不同类型文件中访问数据更有效</p>
<h4 id="size-1"><a href="#size-1" class="headerlink" title="size"></a>size</h4><p>符号的大小。各种符号的大小各不相同，比如一个对象的大小就是它实际占用的字节数。</p>
<h3 id="text"><a href="#text" class="headerlink" title="text"></a>text</h3><p>本节包含程序指令代码</p>
<h1 id="段"><a href="#段" class="headerlink" title="段"></a>段</h1><p>要执行一个程序，系统要先把相应的可执行文件和动态连接库装载到进程空间中，这样形成一个可运行的进程的内存空间布局，也可以称它为“进程镜像”。<br>权限相同的节分别映射容易浪费页，因为映射必须以页为单位才可以方便进行权限管理、换入换出等操作(段式现往往用于在页式前划分空间)，因此将权限相同的节合并为段一起映射，用于加载执行。<br>这也就是前面看节表时发现如下具有W权限的节明显新分配到了一个页<br><img src="https://i.imgur.com/EOB8ity.png" alt=""><br>文件映射到这俩个段时邻界部分会被映射俩次，文件是紧凑连续的，并作为源，分页映射到内存会按文件中段的要求映射内存，因此邻界区会有一页的重复<br>总体上看，文件在内存中被拉长了，但每个段内的相对位置不会变，<strong>内存内段内某个位置-程序头指定VA=文件中的这个位置-程序头指定文件偏移</strong><br>举例：<br>dynamic中的:pltgot指定的VA为0x11f98<br>根据段头表指定的分段位于7号 GNU Read-only After Relocation段。该段头指定了：<br><img src="https://i.imgur.com/AISLwhh.png" alt=""><br>节头中指定了：<br><img src="https://i.imgur.com/lVP2J6Q.png" alt=""><br>因此满足：0x11f98-0x11D80=0x1f98-0x1d80</p>
<p>因此程序头实际上就是指定了应该把文件中的那一部分映射到内存中的那一部分。其中文件的部分用文件偏移表示，内存中的部分用VA表示，文件偏移相对0，内存VA也是相对基地址的（默认为0）。<br>操作系统先将文件按程序头的规定映射到内存中（实际是形成页表），再按程序头中的内容解析整个elf文件，因为此时解析都是读取的内存中的数据（从文件取太慢太多次了）因此程序头中的内容按VA表示更方便定位。所以elf可执行与so中的地址数据都是VA的！！！！！！！！<br>具体看exec的源码分析，其中有几个段指明的部分是重复的，是为了指明信息，如动态段的位置、连接器的路径、栈信息等</p>
<h2 id="程序头"><a href="#程序头" class="headerlink" title="程序头"></a>程序头</h2><p>一个可执行文件或共享目标文件的程序头表(program header table)是一个数组， 数组中的每一个元素称为“程序头(program header)”，每一个程序头描述了一个 “段(segment)”或者一块用于准备执行程序的信息。一个目标文件中的“段 (segment)”包含一个或者多个“节(section)”。程序头只对可执行文件或共享目标文件有意义，对于其它类型的目标文件，该信息可以忽略。在目标文件的文件头 (elf header)中，e-phentsize和 e-phnum成员指定了程序头的大小。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">typedef struct &#123;</div><div class="line">	Elf64_Half	p_type;		/* entry type类型 */</div><div class="line">	Elf64_Half	p_flags;	/* flags 标志*/</div><div class="line">	Elf64_Off	p_offset;	/* offset 文件偏移*/</div><div class="line">	Elf64_Addr	p_vaddr;	/* virtual address 虚拟地址*/</div><div class="line">	Elf64_Addr	p_paddr;	/* physical address 物理地址*/</div><div class="line">	Elf64_Xword	p_filesz;	/* file size 文件中大小*/</div><div class="line">	Elf64_Xword	p_memsz;	/* memory size 镜像中大小*/</div><div class="line">	Elf64_Xword	p_align;	/* memory &amp; file alignment对齐 */</div><div class="line">&#125; Elf64_Phdr;</div></pre></td></tr></table></figure></p>
<p>有些程序头的内容是描述进程内的段，而有的是给出一些辅助信息，并不直接成为段的内容</p>
<h3 id="type-2"><a href="#type-2" class="headerlink" title="type"></a>type</h3><p>此数据成员说明了本程序头所描述的段的类型，或者如何解析本程序头的信息。<br>除非有特别要求，否则所有程序头的段类型域 p-type 都是可选项，不是必须存在的。在所有程序头都不指定段类型的情况下，程序头表中所有的表项都不代表任何特别的类型，而只是作为一种索引，表明其相应的段的大小和位置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">/* Segment types - p_type */</div><div class="line">#define PT_NULL		0		/* unused */</div><div class="line">#define PT_LOAD		1		/* loadable segment */</div><div class="line">#define PT_DYNAMIC	2		/* dynamic linking section */</div><div class="line">#define PT_INTERP	3		/* the RTLD */</div><div class="line">#define PT_NOTE		4		/* auxiliary information */</div><div class="line">#define PT_SHLIB	5		/* reserved - purpose undefined */</div><div class="line">#define PT_PHDR		6		/* program header */</div><div class="line">#define PT_NUM		7		/* Number of segment types */</div><div class="line">#define PT_LOOS		0x60000000	/* reserved range for OS */</div><div class="line">#define PT_HIOS		0x6fffffff	/*  specific segment types */</div><div class="line">#define PT_LOPROC	0x70000000	/* reserved range for processor */</div><div class="line">#define PT_HIPROC	0x7fffffff	/*  specific segment types */</div><div class="line">010edit模板中的：</div><div class="line"></div><div class="line">// Program Header Types</div><div class="line">typedef enum &lt;Elf32_Word&gt; &#123;</div><div class="line">    PT_NULL                     = 0x0,</div><div class="line">    PT_LOAD                     = 0x1,</div><div class="line">    PT_DYNAMIC                  = 0x2,</div><div class="line">    PT_INERP                    = 0x3,</div><div class="line">    PT_NOTE                     = 0x4,</div><div class="line">    PT_SHLIB                    = 0x5,</div><div class="line">    PT_PHDR                     = 0x6,</div><div class="line">    PT_TLS                      = 0x7,</div><div class="line">    PT_NUM                      = 0x8,</div><div class="line">    PT_LOOS                     = 0x60000000,</div><div class="line">    PT_GNU_EH_FRAME             = 0x6474e550,</div><div class="line">    PT_GNU_STACK                = 0x6474e551,</div><div class="line">    PT_GNU_RELRO                = 0x6474e552,</div><div class="line">    PT_LOSUNW                   = 0x6ffffffa,</div><div class="line">    PT_SUNWBSS                  = 0x6ffffffa,</div><div class="line">    PT_SUNWSTACK                = 0x6ffffffb,</div><div class="line">    PT_HISUNW                   = 0x6fffffff,</div><div class="line">    PT_HIOS                     = 0x6fffffff,</div><div class="line">    PT_LOPROC                   = 0x70000000,</div><div class="line">    PT_HIPROC                   = 0x7fffffff,</div><div class="line">    // ARM Sections</div><div class="line">    PT_SHT_ARM_EXIDX            = 0x70000001,</div><div class="line">    PT_SHT_ARM_PREEMPTMAP       = 0x70000002,</div><div class="line">    PT_SHT_ARM_ATTRIBUTES       = 0x70000003,</div><div class="line">    PT_SHT_ARM_DEBUGOVERLAY     = 0x70000004,</div><div class="line">    PT_SHT_ARM_OVERLAYSECTION   = 0x70000005</div><div class="line">&#125; p_type32_e;</div><div class="line">typedef p_type32_e p_type64_e;</div></pre></td></tr></table></figure></p>
<h4 id="NULL-1"><a href="#NULL-1" class="headerlink" title="NULL"></a>NULL</h4><p>此类型表明本程序头是未使用的，本程序头内的其它成员值均无意义。具有此种类型的程序头应该被忽略。 </p>
<h4 id="LOAD"><a href="#LOAD" class="headerlink" title="LOAD"></a>LOAD</h4><p>此类型表明本程序头指向一个可装载的段。段的内容会被从文件中拷贝到内存中。段在文件中的大小是p-filesz，在内存中的大小是p-memsz。如果 p-memsz大于 p-filesz，在内存中多出的存储空间应填0补充，也就是说，段在内存中可以比在文件中占用空间更大；而相反，p-filesz 永远不应该比 p-memsz大，因为这样的话，内存中就将无法完整地映射段的内容。在程序头表中，所有 PT-LOAD类型的程序头按照 p-vaddr的值做升序排列。</p>
<h4 id="DYNAMIC-1"><a href="#DYNAMIC-1" class="headerlink" title="DYNAMIC"></a>DYNAMIC</h4><p>此类型表明本段指明了动态连接的信息。 </p>
<h4 id="INTERP"><a href="#INTERP" class="headerlink" title="INTERP"></a>INTERP</h4><p>本段指向了一个以”null”结尾的字符串，这个字符串是一个 ELF解析器的路径。这种段类型只对可执行程序有意义，当它出现在共享目标文件中时， 是一个无意义的多余项。在一个ELF文件中它多只能出现一次，而且必须出现在其它可装载段的表项之前。</p>
<h4 id="NOTE-1"><a href="#NOTE-1" class="headerlink" title="NOTE"></a>NOTE</h4><p>本段指向了一个以”null”结尾的字符串，这个字符串包含一些附加的信息。 </p>
<h4 id="SHLIB-1"><a href="#SHLIB-1" class="headerlink" title="SHLIB"></a>SHLIB</h4><p>该段类型是保留的，而且未定义语法。</p>
<h4 id="PHDR"><a href="#PHDR" class="headerlink" title="PHDR"></a>PHDR</h4><p>此类型的程序头如果存在的话，它表明的是其自身所在的程序头表在文件或内存中的位置和大小。这样的段在文件中可以不存在，只有当所在程序头表所覆盖的段只是整个程序的一部分时，才会出现一次这种表项，而且这种表项一定出现在其它可装载段的表项之前。</p>
<h4 id="L-H"><a href="#L-H" class="headerlink" title="L-H"></a>L-H</h4><p>系统与处理器保留</p>
<h3 id="offset-2"><a href="#offset-2" class="headerlink" title="offset"></a>offset</h3><p>此数据成员给出本段内容在文件中的位置，即段内容的开始位置相对于文件开头的偏移量。</p>
<h3 id="vaddr"><a href="#vaddr" class="headerlink" title="vaddr"></a>vaddr</h3><p>此数据成员给出本段内容的开始位置在进程空间中的虚拟地址。<br>在被加载到进程空间里时，尽管“段”会被分配到一个不确定的地址，但是不同的段之间会有确定的“相对位置(relative position)”。也就是说，在目标文件中存储的两个段，它们的位置之间有多少偏移，当它们被加载到内存中时，这两个段的位置之间仍然保持这么大的偏移（距离）。映射在不同进程中的同一so段间距离相等。<br>文件中写的虚拟地址与实际内存中的虚拟地址之差为基地址。基地址计算方法见源码分析</p>
<h3 id="paddr"><a href="#paddr" class="headerlink" title="paddr"></a>paddr</h3><p>此数据成员给出本段内容的开始位置在进程空间中的物理地址。对于目前大多数现代操作系统而言，应用程序中段的物理地址事先是不可知的，所以目前这个成员多数情况下保留不用，或者被操作系统改作它用。</p>
<h3 id="filesz"><a href="#filesz" class="headerlink" title="filesz"></a>filesz</h3><p>此数据成员给出本段内容在文件中的大小，单位是字节，可以是 0。 </p>
<h3 id="memsz"><a href="#memsz" class="headerlink" title="memsz"></a>memsz</h3><p>此数据成员给出本段内容在内容镜像中的大小，单位是字节，可以是 0。 </p>
<h3 id="flags-2"><a href="#flags-2" class="headerlink" title="flags"></a>flags</h3><p>此数据成员给出了本段内容的属性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/* Segment flags - p_flags */</div><div class="line">#define PF_X		0x1		/* Executable 执行*/</div><div class="line">#define PF_W		0x2		/* Writable 写*/</div><div class="line">#define PF_R		0x4		/* Readable 读*/</div><div class="line">#define PF_MASKPROC	0xf0000000	/* reserved bits for processor处理器保留 */</div><div class="line">					/*  specific segment flags */</div></pre></td></tr></table></figure></p>
<p>实际的权限依据系统的内存管理器处理，可能比给的权限大</p>
<h3 id="align"><a href="#align" class="headerlink" title="align"></a>align</h3><p>对于可装载的段来说，其 p-vaddr和 p-offset的值至少要向内存页面大小对 齐。此数据成员指明本段内容如何在内存和文件中对齐。如果该值为 0或 1，表明 没有对齐要求；否则，p-align应该是一个正整数，并且是 2 的幂次数。p-vaddr和 p-offset在对 p-align取模后应该相等。 </p>
<h2 id="段内容"><a href="#段内容" class="headerlink" title="段内容"></a>段内容</h2><p>一个段可以包含多个节，方便装载。程序头只关心段</p>
<h3 id="注释段NOTE"><a href="#注释段NOTE" class="headerlink" title="注释段NOTE"></a>注释段NOTE</h3><p>NOTE的段往往会包含类型为 NOTE的节，NOTE节可 以为目标文件提供一些特别的信息，用于给其它的程序检查目标文件的一致性和兼容性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">typedef struct &#123;</div><div class="line">	Elf64_Half namesz;</div><div class="line">	Elf64_Half descsz;</div><div class="line">	Elf64_Half type;</div><div class="line">&#125; Elf64_Note;</div></pre></td></tr></table></figure></p>
<p>注释节中包含三种信息：名字 (name/namesz)、类型(type)和描述(desc/descsz)。<br>名字用于区别不同的信息提供者， 比如不同的厂商，”ABC Computer Company”或”XYZ Computer Company”。<br>一个信息提供者可能会提供很多种信息，为了区别，把信息分类，即给每一种 信息加一个 ID，或者说是类型 type。<br>有了 name和 type的约束，desc的内容才有意义，才知道它所描述的是什么。 </p>
<h3 id="程序解析器-动调连接器INTERP"><a href="#程序解析器-动调连接器INTERP" class="headerlink" title="程序解析器/动调连接器INTERP"></a>程序解析器/动调连接器INTERP</h3><p>这个串指明了一个 ELF程序解析器，系统会转去初始化该解析器的进程镜像。也就是，在这时系统会暂停原来的工作，不是用待执行文件的段内容去初始化进程空间，而是把进程空间暂时“借”给解析器程序使用。然后，解析器程序将从系统手中接过控制权继续执行。<br>在 Intel架构下，系统中自带一种符合 ELF规范的程序解析器： /usr/lib/libc.so.1。 </p>
<p>当创建一个可执行文件时，如果依赖其它的动态连接库，那么连接编辑器会在可执行文件的程序头中加入一个 PT-INTERP项，告诉系统这里需要使用动态连接器。</p>
<p><img src="https://i.imgur.com/osHe9oH.png" alt=""></p>
<p>通过dynamic段取到需要的so，在程序加载到内存执行前完成加载so并重定位。</p>
<h3 id="动态段DYNAMIC"><a href="#动态段DYNAMIC" class="headerlink" title="动态段DYNAMIC"></a>动态段DYNAMIC</h3><p>如果一个目标文件参与动态连接的话，它的程序头表中一定会包含一个类型为PT-DYNAMIC的表项，其所对应的段称为动态段(dynamic segment)，段的名字为.dynamic。动态段的作用是提供动态连接器所需要的信息，比如依赖于哪些共享目标文件、动态连接符号表的位置、动态连接重定位表的位置等等。<br>这个动态段中包含有动态节：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">typedef struct &#123;</div><div class="line">	Elf64_Xword	d_tag;		/* controls meaning of d_val */</div><div class="line">	union &#123;</div><div class="line">		Elf64_Addr	d_ptr;  //地址是VA的，相对基址</div><div class="line">		//这个位置是相对程序的装载基址的，不同权限的段会被加载到不同的页，因此不同的俩项该地址差距可能很大</div><div class="line">		Elf64_Xword	d_val;</div><div class="line">	&#125; d_un;</div><div class="line">&#125; Elf64_Dyn;</div></pre></td></tr></table></figure></p>
<p>对于每一项，tag控制着对un的解析<br><img src="https://i.imgur.com/CeffDqZ.png" alt=""></p>
<h4 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">/* Dynamic Array Tags - d_tag */</div><div class="line">            名称   值      un    可执行文件   共享目标文件</div><div class="line">#define DT_NULL		0		/*忽略 必须 必须   */</div><div class="line">#define DT_NEEDED	1		/*val 可选 可选  */</div><div class="line">#define DT_PLTRELSZ	2		/*val 可选 可选  */</div><div class="line">#define DT_PLTGOT	3		/*ptr 可选 可选  */</div><div class="line">#define DT_HASH		4		/*ptr 必须 必须  */</div><div class="line">#define DT_STRTAB	5		/*ptr 必须 必须  */</div><div class="line">#define DT_SYMTAB	6		/*ptr 必须 必须  */</div><div class="line">#define DT_RELA		7		/*ptr 必须 可选  */</div><div class="line">#define DT_RELASZ	8		/*val 必须 可选  */</div><div class="line">#define DT_RELAENT	9		/*val 必须 可选  */</div><div class="line">#define DT_STRSZ	10		/*val 必须 必须  */</div><div class="line">#define DT_SYMENT	11		/*val 必须 必须*/</div><div class="line">#define DT_INIT		12		/*ptr 可选 可选  */</div><div class="line">#define DT_FINI		13		/*ptr 可选 可选  */</div><div class="line">#define DT_SONAME	14		/*val 忽略 可选  */</div><div class="line">#define DT_RPATH	15		/*val 可选 忽略  */</div><div class="line">#define DT_SYMBOLIC	16		/*忽略 忽略 可选  */</div><div class="line">#define DT_REL		17		/*ptr 必须 可选  */</div><div class="line">#define DT_RELSZ	18		/*val 必须 可选 */</div><div class="line">#define DT_RELENT	19		/*val 必须 可选  */</div><div class="line">#define DT_PLTREL	20		/*val 可选 可选  */</div><div class="line">#define DT_DEBUG	21		/*ptr 可选 可选  */</div><div class="line">#define DT_TEXTREL	22		/*忽略 可选 可选  */</div><div class="line">#define DT_JMPREL	23		/*ptr 可选 可选  */</div><div class="line">#define DT_BIND_NOW	24		/*忽略 可选 可选  */</div><div class="line">#define DT_NUM		25		/*数量  */</div><div class="line">#define DT_LOPROC	0x70000000	/*  */</div><div class="line">#define DT_HIPROC	0x7fffffff	/*   */</div></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/Y25pX1x.png" alt=""><br>图：dynamic-so<br><img src="https://i.imgur.com/SNz1mjh.png" alt=""><br>图：dynamic-exe</p>
<p><strong>NULL</strong><br>用于标记DYNAMIC数组的结束。 </p>
<p><strong>NEEDED</strong><br>此元素指明了一个所需的库的名字。不过此元素本身并不是一个字符串，它是一个指向由”DT-STRTAB”所标记的字符串表中的索引，在表中，此索引处是一个以’null’结尾的字符串，这个字符串就是库的名字。在动态数组中可以包含若干个此类型的项，这些项出现的相对顺序是不能随意调换的。</p>
<p><strong>PLTRELSZ</strong><br>此元素含有与函数连接表相关的所有重定位项的总大小，以字节为单位。如果数组中有DT-JMPREL项的话，DT-PLTRELSZ也必须要有。 </p>
<p><strong>PLTGOT</strong><br>此元素包含与函数连接表或全局偏移量表相应的地址。</p>
<p><strong>HASH</strong><br>此元素含有符号哈希表的地址。</p>
<p><strong>STRTAB</strong><br>此元素包含字符串表的地址，此表中包含符号名、库名等等。 </p>
<p><strong>SYMTAB</strong><br>此元素包含符号表的地址。 </p>
<p><strong>RELA</strong><br>此元素包含一个重定位表的地址。就是前面的Rela，表明了从哪个符号表找到符号去哪里如何修改地址</p>
<p><strong>RELASZ</strong><br>此元素持有DT-RELA相应的重定位表的大小，以字节为单位。 </p>
<p><strong>RELAENT</strong><br>此元素持有DT-RELA相应的重定位表项的大小，以字节为单位。 </p>
<p><strong>STRSZ</strong><br>此元素持有字符串表的大小，以字节为单位。 </p>
<p><strong>SYMENT</strong><br>此元素持有符号表项的大小，以字节为单位。 </p>
<p><strong>INIT</strong><br>此元素持有初始化函数的地址。</p>
<p><strong>FINI</strong><br>此元素持有终止函数的地址。</p>
<p><strong>SONAME</strong><br>此元素持有一个字符串表中的偏移量，该位置存储了一个以’null’结尾的字符串，是一个共享目标的名字。相应的字符串表由DT-STRTAB指定。<br>自己的名字</p>
<p><strong>RPATH</strong><br>此元素持有一个字符串表中的偏移量，该位置存储了一个以’null’结尾的字符串，是一个用于搜索库文件的路径名。相应的字符串表由DT-STRTAB指定。 </p>
<p><strong>SYMBOLIC</strong><br>在共享目标文件中，此元素的出现与否决定了动态连接器解析符号时所用的算法。先搜素可执行文件还是库文件</p>
<p><strong>REL</strong><br>此元素与DT-RELA相似，只是它所指向的重定位表中，“加数”是隐含的而不是显式的。与静态中的相同</p>
<p><strong>RELSZ</strong><br>此元素持有DT-REL相应的重定位表的大小，以字节为单位。 </p>
<p><strong>RELENT</strong><br>此元素持有DT-REL相应的重定位表项的大小，以字节为单位。 </p>
<p><strong>PLTREL</strong><br>本成员指明了函数连接表所引用的重定位项的类型。d-val成员含有DT-REL或DT-RELA。函数连接表中的所有重定位类型都是相同的。</p>
<p><strong>DEBUG</strong><br>本成员用于调试，格式未明确定义。</p>
<p><strong>TEXTREL</strong><br>如果此元素出现的话，在重定位过程中如果需要修改的是只读段的话，连接编辑器可以做相应的修改。 </p>
<p><strong>JMPREL</strong><br>此类型元素如果存在的话，其d-ptr成员含有与函数连接表单独关联的重定位项地址。把多个重定位项分开可以让动态连接器在初始化的时候忽略它们，当然前提条件是“后期绑定”是激活的。如果此元素存在的话，DT-PLTRELSZ和DT-PLTREL也应该出现。 </p>
<p><strong>BIND-NOW</strong><br>如果此元素存在的话，动态连接器必须在程序开始执行以前，完成所有包含此项的目标的重定位工作。如果此元素存在，即使程序应用了“后期绑定”，它对于此项所指定的目标也不适用，动态连接器仍需事先做好重定位。 </p>
<p><strong>L-H</strong><br>处理器保留</p>
<h4 id="共享目标的依赖关系"><a href="#共享目标的依赖关系" class="headerlink" title="共享目标的依赖关系"></a>共享目标的依赖关系</h4><p>静态连接下，连接器提取库的成员拷贝到输出文件中。动态连接下需要找到so库并添加到进程中。详见linker源码分析<br>当动态连接器为一个目标文件创建内存段的时候，动态结构中的 DT-NEEDED 项会指明所依赖的库，动态连接器会连接被引用的符号和它们所依赖的库，这个过程会反复地执行，直到一个完整的进程镜像被构建好。当解析一个符号引用的时候，动态连接器以一种“广度优先”的算法来查找符号表。就是说，动态连接器首先查找可执行程序自己的符号表，然后是 DT-NEEDED项所指明的库的符号表， 再接下来是下一层依赖库的符号表，依次下去。共享目标文件必须是可读的，其它权限没有要求。<br>共享库加载后会记录其名字，只引用一次，名字可以是SONAME也可以是共享文件的路径名。<br>寻找时，如果共享库名字中含有/，则直接把字符串作为路径名，如果没有，则按如下顺序查找：</p>
<ol>
<li>RPATH可能给出了一个含有一系列目录名的字符串，各目录名以冒号”:”相隔。在这些目录下依次查找</li>
<li>进程的环境变量中会有一个 <code>LD_LIBRARY_PATH</code>变量，它也含有一个目录名列表，各目录名以冒号”:”相隔，各目录名列表以分号”;” 相隔。</li>
<li>如果如上两组路径都无法找到所要的库，动态连接库就搜索/usr/lib。 </li>
</ol>
<h4 id="全局偏移量表got"><a href="#全局偏移量表got" class="headerlink" title="全局偏移量表got"></a>全局偏移量表got</h4><p>该表不通过处理器架构格式与解析方式不同。<br>可执行文件和共享目标文件有各自的全局偏移量表<br>详细分析见下文</p>
<h4 id="函数连接表plt"><a href="#函数连接表plt" class="headerlink" title="函数连接表plt"></a>函数连接表plt</h4><p>该表不同处理器下实现不同<br>可执行文件和共享目标文件有各自的函数连接表。<br>详细分析见下文</p>
<h4 id="解析符号"><a href="#解析符号" class="headerlink" title="解析符号"></a>解析符号</h4><p>具体见linker分析 </p>
<ol>
<li>在一开始创建程序内存镜像的时候，动态连接器把全局偏移量表中的第 2和第 3个表项设为特定值。下面的步骤中会解析所设置的值。 </li>
<li>如果函数连接表是位置独立的，全局偏移量表的地址必须存储在 %ebx中。进程空间中的每一个共享目标文件都有自己的函数连接表，每一个表都是用于本文件内的函数调用。那么，主调函数就要负责在调用函数连接表项之前设置全局偏移量表。 </li>
<li>这里做个示例，假设程序要调用函数 name1，与之相应的函数连接表是.PLT1。</li>
<li>第一条指令跳转到 name1所在全局偏移量表项中的地址。一开始， 全局偏移量表中持有的是”push1”指令的地址，而不是”name1”的地址。</li>
<li>接下来，程序把一个重定位偏移量压入堆栈。重定位偏移量是一个 32位的非负数，它指向重定位表内的一项。被指定的重定位项类型为 R-386-JMP-SLOT，它的”offset”指定了前一个”jmp”指令所用到的一个全局 偏移表项。重定位项也包含一个符号表索引，为动态连接器指明了正被引用 的是什么符号，在本例是即”name1”。 </li>
<li>把重定位偏移量压栈以后，程序就跳到.PLT0，即函数连接表的第一项。”push1”指令把全局偏移量表的第 2项(got-plus-4 or 4(%ebx))压入栈 顶，因此给了动态连接器一个字的确认信息。接下来，程序跳转到全局偏移 量表的第 3项(got-plus-8 or 8(%ebx))中的地址，控制权就又交给了动态连接器。 </li>
<li>动态连接器接过控制权后，它弹出栈顶数据，查找指定的重定位项，找到符号的值，把”name1”真正的地址存储在全局偏移量表项中，并把控制权传给指定的目标。</li>
<li>接下来，函数连接表会把控制权直接转到 name1，不需要动态连接 器再次介入。也就是说，.PLT1处的 jmp指令会跳转到 name1。</li>
</ol>
<p>这就是后期绑定</p>
<h4 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h4><p><img src="https://i.imgur.com/PlDTBOD.png" alt=""><br>图hash</p>
<p>不是规范的一部分，可能有不同实现</p>
<p>Bucket数组中含有 nbucket个项，chain数组中含有 nchain个项，序号都从0开始。Bucket和 chain中包含的都是符号表中的索引。符号表中的项数必须等于 nchain，所以符号表中的索引号也可以用来索引chain表。如下所示的一个哈希函数输入一个符号名，输出一个值用于计算 bucket索引。如果给出一个符号名，经哈希函数计算得到值 x，那么 x%nbucket是 bucket表内的索引，bucket[x%nbucket] 给出一个符号表的索引值y，y同时也是chain表内的索引值。如果符号表内索引值为 y的元素并不是所要的，那么 chain[y]给出符号表中下一个哈希值相同的项的索引。如果所有哈希值相同的项都不是所要的，后的一个 chain[y]将包含值 STN-UNDEF，说明这个符号表中并不含有此符号。</p>
<h4 id="初始化和终止函数"><a href="#初始化和终止函数" class="headerlink" title="初始化和终止函数"></a>初始化和终止函数</h4><p>当动态连接器构建好进程镜像，并完成重定位后，每一个共享目标都有机会执 行一些初始化代码。所有共享目标的初始化都发生在程序开始执行前。<br>依赖需要先初始化，动态连接器保证其只调用一次，动态连接器只负责共享目标文件中的初始化和终止化，并不负责可执行文件。</p>
<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><h2 id="一个so的解析"><a href="#一个so的解析" class="headerlink" title="一个so的解析"></a>一个so的解析</h2><h3 id="源："><a href="#源：" class="headerlink" title="源："></a>源：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">#include&lt;stdio.h&gt;</div><div class="line">#include &lt;jni.h&gt;</div><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &lt;unistd.h&gt;</div><div class="line">#include &lt;pthread.h&gt;</div><div class="line">struct NativeWorkerArgs</div><div class="line">&#123;</div><div class="line">    jint id;</div><div class="line">    jint iterations;</div><div class="line">&#125;;</div><div class="line">static jmethodID gOnNativeMessage = NULL;</div><div class="line">// Java VM interface pointer</div><div class="line">static JavaVM* gVm = NULL;</div><div class="line">// Global reference to object</div><div class="line">static jobject gObj = NULL;</div><div class="line"></div><div class="line">int a;</div><div class="line">int b=3;</div><div class="line">extern int g_int1, g_int2; </div><div class="line">char s[]=&quot;123456&quot;;</div><div class="line"></div><div class="line">jint JNI_OnLoad (JavaVM* vm, void* reserved)</div><div class="line">&#123;</div><div class="line">    // Cache the JavaVM interface pointer</div><div class="line">    gVm = vm;</div><div class="line">    return JNI_VERSION_1_4;</div><div class="line">&#125;</div><div class="line"></div><div class="line">extern &quot;C&quot; JNIEXPORT</div><div class="line">JNIEXPORT void JNICALL</div><div class="line">Java_com_example_imbaya_native1_MainActivity_nativeFree(JNIEnv *env, jobject obj) &#123;</div><div class="line"></div><div class="line">    // If object global reference is set</div><div class="line">    if (NULL != gObj)</div><div class="line">    &#123;</div><div class="line">        // Delete the global reference</div><div class="line">        env-&gt;DeleteGlobalRef(gObj);</div><div class="line">        gObj = NULL;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">static void* nativeWorkerThread (void* args)</div><div class="line">&#123;</div><div class="line">    JNIEnv* env = NULL;</div><div class="line">    // Attach current thread to Java virtual machine</div><div class="line">    // and obrain JNIEnv interface pointer</div><div class="line">    if (0 == gVm-&gt;AttachCurrentThread(&amp;env, NULL))</div><div class="line">    &#123;</div><div class="line">        // Get the native worker thread arguments</div><div class="line">        NativeWorkerArgs* nativeWorkerArgs = (NativeWorkerArgs*) args;</div><div class="line">        // Run the native worker in thread context</div><div class="line">        Java_com_example_imbaya_native1_MainActivity_nativeWorker(env,</div><div class="line">                                                          gObj,</div><div class="line">                                                          nativeWorkerArgs-&gt;id,</div><div class="line">                                                          nativeWorkerArgs-&gt;iterations);</div><div class="line">        // Free the native worker thread arguments</div><div class="line">        delete nativeWorkerArgs;</div><div class="line">        // Detach current thread from Java virtual machine</div><div class="line">        gVm-&gt;DetachCurrentThread();</div><div class="line">    &#125;</div><div class="line">    return (void*) 1;</div><div class="line">&#125;</div><div class="line">......</div><div class="line">extern &quot;C&quot;</div><div class="line">JNIEXPORT void JNICALL</div><div class="line">Java_com_example_imbaya_native1_MainActivity_posixThreads2(JNIEnv *env, jobject instance,</div><div class="line">                                                           jint threads, jint iterations) &#123;</div><div class="line"></div><div class="line">    // TODO</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="结果："><a href="#结果：" class="headerlink" title="结果："></a>结果：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div></pre></td><td class="code"><pre><div class="line">ELF Header:</div><div class="line">  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00</div><div class="line">  Class:                             ELF64</div><div class="line">  Data:                              2&apos;s complement, little endian</div><div class="line">  Version:                           1 (current)</div><div class="line">  OS/ABI:                            UNIX - System V</div><div class="line">  ABI Version:                       0</div><div class="line">  Type:                              DYN (Shared object file)</div><div class="line">  Machine:                           AArch64</div><div class="line">  Version:                           0x1</div><div class="line">  Entry point address:               0x9d0</div><div class="line">  Start of program headers:          64 (bytes into file)</div><div class="line">  Start of section headers:          8528 (bytes into file)</div><div class="line">  Flags:                             0x0</div><div class="line">  Size of this header:               64 (bytes)</div><div class="line">  Size of program headers:           56 (bytes)</div><div class="line">  Number of program headers:         8</div><div class="line">  Size of section headers:           64 (bytes)</div><div class="line">  Number of section headers:         23</div><div class="line">  Section header string table index: 22</div><div class="line"></div><div class="line">Section Headers:</div><div class="line">  [Nr] Name              Type             Address           Offset</div><div class="line">       Size              EntSize          Flags  Link  Info  Align</div><div class="line">  [ 0]                   NULL             0000000000000000  00000000</div><div class="line">       0000000000000000  0000000000000000           0     0     0</div><div class="line">  [ 1] .note.gnu.build-i NOTE             0000000000000200  00000200</div><div class="line">       0000000000000024  0000000000000000   A       0     0     4</div><div class="line">  [ 2] .hash             HASH             0000000000000228  00000228</div><div class="line">       00000000000000bc  0000000000000004   A       3     0     8</div><div class="line">  [ 3] .dynsym           DYNSYM           00000000000002e8  000002e8</div><div class="line">       00000000000002a0  0000000000000018   A       4     3     8</div><div class="line">  [ 4] .dynstr           STRTAB           0000000000000588  00000588</div><div class="line">       0000000000000230  0000000000000000   A       0     0     1</div><div class="line">  [ 5] .gnu.version      VERSYM           00000000000007b8  000007b8</div><div class="line">       0000000000000038  0000000000000002   A       3     0     2</div><div class="line">  [ 6] .gnu.version_r    VERNEED          00000000000007f0  000007f0</div><div class="line">       0000000000000040  0000000000000000   A       4     2     8</div><div class="line">  [ 7] .rela.dyn         RELA             0000000000000830  00000830</div><div class="line">       0000000000000018  0000000000000018   A       3     0     8</div><div class="line">  [ 8] .rela.plt         RELA             0000000000000848  00000848</div><div class="line">       00000000000000d8  0000000000000018  AI       3    18     8</div><div class="line">  [ 9] .plt              PROGBITS         0000000000000920  00000920</div><div class="line">       00000000000000b0  0000000000000010  AX       0     0     16</div><div class="line">  [10] .text             PROGBITS         00000000000009d0  000009d0</div><div class="line">       0000000000000514  0000000000000000  AX       0     0     4</div><div class="line">  [11] .rodata           PROGBITS         0000000000000ee4  00000ee4</div><div class="line">       0000000000000087  0000000000000001 AMS       0     0     1</div><div class="line">  [12] .eh_frame_hdr     PROGBITS         0000000000000f6c  00000f6c</div><div class="line">       000000000000004c  0000000000000000   A       0     0     4</div><div class="line">  [13] .eh_frame         PROGBITS         0000000000000fb8  00000fb8</div><div class="line">       0000000000000138  0000000000000000   A       0     0     8</div><div class="line">  [14] .note.android.ide NOTE             00000000000010f0  000010f0</div><div class="line">       0000000000000098  0000000000000000   A       0     0     4</div><div class="line">  [15] .init_array       INIT_ARRAY       0000000000011d80  00001d80</div><div class="line">       0000000000000008  0000000000000008  WA       0     0     1</div><div class="line">  [16] .fini_array       FINI_ARRAY       0000000000011d88  00001d88</div><div class="line">       0000000000000010  0000000000000008  WA       0     0     8</div><div class="line">  [17] .dynamic          DYNAMIC          0000000000011d98  00001d98</div><div class="line">       0000000000000200  0000000000000010  WA       4     0     8</div><div class="line">  [18] .got              PROGBITS         0000000000011f98  00001f98</div><div class="line">       0000000000000068  0000000000000008  WA       0     0     8</div><div class="line">  [19] .data             PROGBITS         0000000000012000  00002000</div><div class="line">       0000000000000013  0000000000000000  WA       0     0     8</div><div class="line">  [20] .bss              NOBITS           0000000000012018  00002013</div><div class="line">       0000000000000020  0000000000000000  WA       0     0     8</div><div class="line">  [21] .comment          PROGBITS         0000000000000000  00002013</div><div class="line">       0000000000000064  0000000000000001  MS       0     0     1</div><div class="line">  [22] .shstrtab         STRTAB           0000000000000000  00002077</div><div class="line">       00000000000000d8  0000000000000000           0     0     1</div><div class="line">Key to Flags:</div><div class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),</div><div class="line">  L (link order), O (extra OS processing required), G (group), T (TLS),</div><div class="line">  C (compressed), x (unknown), o (OS specific), E (exclude),</div><div class="line">  p (processor specific)</div><div class="line"></div><div class="line">There are no section groups in this file.</div><div class="line"></div><div class="line">Program Headers:</div><div class="line">  Type           Offset             VirtAddr           PhysAddr</div><div class="line">                 FileSiz            MemSiz              Flags  Align</div><div class="line">  LOAD           0x0000000000000000 0x0000000000000000 0x0000000000000000</div><div class="line">                 0x0000000000001188 0x0000000000001188  R E    0x10000</div><div class="line">  LOAD           0x0000000000001d80 0x0000000000011d80 0x0000000000011d80</div><div class="line">                 0x0000000000000293 0x00000000000002b8  RW     0x10000</div><div class="line">  DYNAMIC        0x0000000000001d98 0x0000000000011d98 0x0000000000011d98</div><div class="line">                 0x0000000000000200 0x0000000000000200  RW     0x8</div><div class="line">  NOTE           0x0000000000000200 0x0000000000000200 0x0000000000000200</div><div class="line">                 0x0000000000000024 0x0000000000000024  R      0x4</div><div class="line">  NOTE           0x00000000000010f0 0x00000000000010f0 0x00000000000010f0</div><div class="line">                 0x0000000000000098 0x0000000000000098  R      0x4</div><div class="line">  GNU_EH_FRAME   0x0000000000000f6c 0x0000000000000f6c 0x0000000000000f6c</div><div class="line">                 0x000000000000004c 0x000000000000004c  R      0x4</div><div class="line">  GNU_STACK      0x0000000000000000 0x0000000000000000 0x0000000000000000</div><div class="line">                 0x0000000000000000 0x0000000000000000  RW     0x10</div><div class="line">  GNU_RELRO      0x0000000000001d80 0x0000000000011d80 0x0000000000011d80</div><div class="line">                 0x0000000000000280 0x0000000000000280  R      0x1</div><div class="line"></div><div class="line"> Section to Segment mapping:</div><div class="line">  Segment Sections...</div><div class="line">   00     .note.gnu.build-id .hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .plt .text .rodata .eh_frame_hdr .eh_frame .note.android.ident</div><div class="line">   01     .init_array .fini_array .dynamic .got .data .bss</div><div class="line">   02     .dynamic</div><div class="line">   03     .note.gnu.build-id</div><div class="line">   04     .note.android.ident</div><div class="line">   05     .eh_frame_hdr</div><div class="line">   06</div><div class="line">   07     .init_array .fini_array .dynamic .got</div><div class="line"></div><div class="line">Dynamic section at offset 0x1d98 contains 28 entries:</div><div class="line">  Tag        Type                         Name/Value</div><div class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so]</div><div class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libc.so]</div><div class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libm.so]</div><div class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libdl.so]</div><div class="line"> 0x000000000000000e (SONAME)             Library soname: [libtest.so]</div><div class="line"> 0x0000000000000019 (INIT_ARRAY)         0x11d80</div><div class="line"> 0x000000000000001b (INIT_ARRAYSZ)       8 (bytes)</div><div class="line"> 0x000000000000001a (FINI_ARRAY)         0x11d88</div><div class="line"> 0x000000000000001c (FINI_ARRAYSZ)       16 (bytes)</div><div class="line"> 0x0000000000000004 (HASH)               0x228</div><div class="line"> 0x0000000000000005 (STRTAB)             0x588</div><div class="line"> 0x0000000000000006 (SYMTAB)             0x2e8</div><div class="line"> 0x000000000000000a (STRSZ)              560 (bytes)</div><div class="line"> 0x000000000000000b (SYMENT)             24 (bytes)</div><div class="line"> 0x0000000000000003 (PLTGOT)             0x11f98</div><div class="line"> 0x0000000000000002 (PLTRELSZ)           216 (bytes)</div><div class="line"> 0x0000000000000014 (PLTREL)             RELA</div><div class="line"> 0x0000000000000017 (JMPREL)             0x848</div><div class="line"> 0x0000000000000007 (RELA)               0x830</div><div class="line"> 0x0000000000000008 (RELASZ)             24 (bytes)</div><div class="line"> 0x0000000000000009 (RELAENT)            24 (bytes)</div><div class="line"> 0x0000000000000018 (BIND_NOW)</div><div class="line"> 0x000000006ffffffb (FLAGS_1)            Flags: NOW</div><div class="line"> 0x000000006ffffffe (VERNEED)            0x7f0</div><div class="line"> 0x000000006fffffff (VERNEEDNUM)         2</div><div class="line"> 0x000000006ffffff0 (VERSYM)             0x7b8</div><div class="line"> 0x000000006ffffff9 (RELACOUNT)          1</div><div class="line"> 0x0000000000000000 (NULL)               0x0</div><div class="line"></div><div class="line">Relocation section &apos;.rela.dyn&apos; at offset 0x830 contains 1 entry:</div><div class="line">  Offset          Info           Type           Sym. Value    Sym. Name + Addend</div><div class="line">000000011d88  000000000403 R_AARCH64_RELATIV                    9d0</div><div class="line"></div><div class="line">Relocation section &apos;.rela.plt&apos; at offset 0x848 contains 9 entries:</div><div class="line">  Offset          Info           Type           Sym. Value    Sym. Name + Addend</div><div class="line">000000011fb0  000300000402 R_AARCH64_JUMP_SL 0000000000000000 sleep@LIBC + 0</div><div class="line">000000011fb8  000500000402 R_AARCH64_JUMP_SL 0000000000000000 pthread_create@LIBC + 0</div><div class="line">000000011fc0  000700000402 R_AARCH64_JUMP_SL 0000000000000000 __cxa_finalize@LIBC + 0</div><div class="line">000000011fc8  000c00000402 R_AARCH64_JUMP_SL 0000000000000000 _ZdlPv@LIBC_O + 0</div><div class="line">000000011fd0  000e00000402 R_AARCH64_JUMP_SL 0000000000000000 __stack_chk_fail@LIBC + 0</div><div class="line">000000011fd8  000f00000402 R_AARCH64_JUMP_SL 0000000000000000 _Znwm@LIBC_O + 0</div><div class="line">000000011fe0  001300000402 R_AARCH64_JUMP_SL 0000000000000000 sprintf@LIBC + 0</div><div class="line">000000011fe8  001a00000402 R_AARCH64_JUMP_SL 0000000000000c1c _ZN7_JNIEnv14CallVoidM + 0</div><div class="line">000000011ff0  001b00000402 R_AARCH64_JUMP_SL 0000000000000000 __cxa_atexit@LIBC + 0</div><div class="line"></div><div class="line">The decoding of unwind sections for machine type AArch64 is not currently supported.</div><div class="line"></div><div class="line">Symbol table &apos;.dynsym&apos; contains 28 entries:</div><div class="line">   Num:    Value          Size Type    Bind   Vis      Ndx Name</div><div class="line">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND</div><div class="line">     1: 00000000000009d0     0 SECTION LOCAL  DEFAULT   10</div><div class="line">     2: 0000000000012000     0 SECTION LOCAL  DEFAULT   19</div><div class="line">     3: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND sleep@LIBC (2)</div><div class="line">     4: 0000000000000ee0     4 FUNC    GLOBAL DEFAULT   10 Java_com_example_imbaya_n</div><div class="line">     5: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND pthread_create@LIBC (2)</div><div class="line">     6: 0000000000012038     0 NOTYPE  GLOBAL DEFAULT  ABS _bss_end__</div><div class="line">     7: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_finalize@LIBC (2)</div><div class="line">     8: 0000000000012018     4 OBJECT  GLOBAL DEFAULT   20 a</div><div class="line">     9: 0000000000012008     4 OBJECT  GLOBAL DEFAULT   19 b</div><div class="line">    10: 000000000001200c     7 OBJECT  GLOBAL DEFAULT   19 s</div><div class="line">    11: 0000000000000b04    52 FUNC    GLOBAL DEFAULT   10 Java_com_example_imbaya_n</div><div class="line">    12: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND _ZdlPv@LIBC_O (3)</div><div class="line">    13: 0000000000000a0c    24 FUNC    GLOBAL DEFAULT   10 JNI_OnLoad</div><div class="line">    14: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __stack_chk_fail@LIBC (2)</div><div class="line">    15: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND _Znwm@LIBC_O (3)</div><div class="line">    16: 0000000000000cbc   232 FUNC    GLOBAL DEFAULT   10 Java_com_example_imbaya_n</div><div class="line">    17: 0000000000012013     0 NOTYPE  GLOBAL DEFAULT  ABS __bss_start</div><div class="line">    18: 0000000000012038     0 NOTYPE  GLOBAL DEFAULT  ABS __end__</div><div class="line">    19: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND sprintf@LIBC (2)</div><div class="line">    20: 0000000000012013     0 NOTYPE  GLOBAL DEFAULT  ABS __bss_start__</div><div class="line">    21: 0000000000000b38   228 FUNC    GLOBAL DEFAULT   10 Java_com_example_imbaya_n</div><div class="line">    22: 0000000000000a24   224 FUNC    GLOBAL DEFAULT   10 Java_com_example_imbaya_n</div><div class="line">    23: 0000000000012013     0 NOTYPE  GLOBAL DEFAULT  ABS _edata</div><div class="line">    24: 0000000000012038     0 NOTYPE  GLOBAL DEFAULT  ABS __bss_end__</div><div class="line">    25: 0000000000012038     0 NOTYPE  GLOBAL DEFAULT  ABS _end</div><div class="line">    26: 0000000000000c1c   160 FUNC    WEAK   DEFAULT   10 _ZN7_JNIEnv14CallVoidMeth</div><div class="line">    27: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_atexit@LIBC (2)</div><div class="line"></div><div class="line">Histogram for bucket list length (total of 17 buckets):</div><div class="line"> Length  Number     % of total  Coverage</div><div class="line">      0  4          ( 23.5%)</div><div class="line">      1  5          ( 29.4%)     20.0%</div><div class="line">      2  5          ( 29.4%)     60.0%</div><div class="line">      3  2          ( 11.8%)     84.0%</div><div class="line">      4  1          (  5.9%)    100.0%</div><div class="line"></div><div class="line">Version symbols section &apos;.gnu.version&apos; contains 28 entries:</div><div class="line"> Addr: 00000000000007b8  Offset: 0x0007b8  Link: 3 (.dynsym)</div><div class="line">  000:   0 (*local*)       0 (*local*)       0 (*local*)       2 (LIBC)</div><div class="line">  004:   1 (*global*)      2 (LIBC)          1 (*global*)      2 (LIBC)</div><div class="line">  008:   1 (*global*)      1 (*global*)      1 (*global*)      1 (*global*)</div><div class="line">  00c:   3 (LIBC_O)        1 (*global*)      2 (LIBC)          3 (LIBC_O)</div><div class="line">  010:   1 (*global*)      1 (*global*)      1 (*global*)      2 (LIBC)</div><div class="line">  014:   1 (*global*)      1 (*global*)      1 (*global*)      1 (*global*)</div><div class="line">  018:   1 (*global*)      1 (*global*)      1 (*global*)      2 (LIBC)</div><div class="line"></div><div class="line">Version needs section &apos;.gnu.version_r&apos; contains 2 entries:</div><div class="line"> Addr: 0x00000000000007f0  Offset: 0x0007f0  Link: 4 (.dynstr)</div><div class="line">  000000: Version: 1  File: libstdc++.so  Cnt: 1</div><div class="line">  0x0010:   Name: LIBC_O  Flags: none  Version: 3</div><div class="line">  0x0020: Version: 1  File: libc.so  Cnt: 1</div><div class="line">  0x0030:   Name: LIBC  Flags: none  Version: 2</div><div class="line"></div><div class="line">Displaying notes found in: .note.gnu.build-id</div><div class="line">  Owner                 Data size       Description</div><div class="line">  GNU                  0x00000014       NT_GNU_BUILD_ID (unique build ID bitstring)</div><div class="line">    Build ID: 2712b618a779fca3051582467c360adff5c8acd5</div><div class="line"></div><div class="line">Displaying notes found in: .note.android.ident</div><div class="line">  Owner                 Data size       Description</div><div class="line">  Android              0x00000084       NT_VERSION (version)</div><div class="line">   description data: 15 00 00 00 72 31 36 62 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 34 34 37 39 34 39 39 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</div></pre></td></tr></table></figure>
<h2 id="一个可执行文件的解析"><a href="#一个可执行文件的解析" class="headerlink" title="一个可执行文件的解析"></a>一个可执行文件的解析</h2><h3 id="源：-1"><a href="#源：-1" class="headerlink" title="源："></a>源：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">int dsad=1;</div><div class="line"></div><div class="line">void f(int abort)</div><div class="line">&#123;</div><div class="line">	printf(&quot;%d&quot;,abort);</div><div class="line">&#125;</div><div class="line">int main(void)</div><div class="line">&#123;</div><div class="line">	int abort=3;</div><div class="line">	printf(&quot;Hello&quot;);</div><div class="line">	f(abort);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="结果：-1"><a href="#结果：-1" class="headerlink" title="结果："></a>结果：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div></pre></td><td class="code"><pre><div class="line">ELF Header:</div><div class="line">  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00</div><div class="line">  Class:                             ELF64</div><div class="line">  Data:                              2&apos;s complement, little endian</div><div class="line">  Version:                           1 (current)</div><div class="line">  OS/ABI:                            UNIX - System V</div><div class="line">  ABI Version:                       0</div><div class="line">  Type:                              DYN (Shared object file)</div><div class="line">  Machine:                           AArch64</div><div class="line">  Version:                           0x1</div><div class="line">  Entry point address:               0x660</div><div class="line">  Start of program headers:          64 (bytes into file)</div><div class="line">  Start of section headers:          4440 (bytes into file)</div><div class="line">  Flags:                             0x0</div><div class="line">  Size of this header:               64 (bytes)</div><div class="line">  Size of program headers:           56 (bytes)</div><div class="line">  Number of program headers:         9</div><div class="line">  Size of section headers:           64 (bytes)</div><div class="line">  Number of section headers:         24</div><div class="line">  Section header string table index: 23</div><div class="line"></div><div class="line">Section Headers:</div><div class="line">  [Nr] Name              Type             Address           Offset</div><div class="line">       Size              EntSize          Flags  Link  Info  Align</div><div class="line">  [ 0]                   NULL             0000000000000000  00000000</div><div class="line">       0000000000000000  0000000000000000           0     0     0</div><div class="line">  [ 1] .interp           PROGBITS         0000000000000238  00000238</div><div class="line">       0000000000000015  0000000000000000   A       0     0     1</div><div class="line">  [ 2] .note.android.ide NOTE             0000000000000250  00000250</div><div class="line">       0000000000000098  0000000000000000   A       0     0     4</div><div class="line">  [ 3] .note.gnu.build-i NOTE             00000000000002e8  000002e8</div><div class="line">       0000000000000024  0000000000000000   A       0     0     4</div><div class="line">  [ 4] .hash             HASH             0000000000000310  00000310</div><div class="line">       0000000000000048  0000000000000004   A       5     0     8</div><div class="line">  [ 5] .dynsym           DYNSYM           0000000000000358  00000358</div><div class="line">       0000000000000138  0000000000000018   A       6     3     8</div><div class="line">  [ 6] .dynstr           STRTAB           0000000000000490  00000490</div><div class="line">       0000000000000099  0000000000000000   A       0     0     1</div><div class="line">  [ 7] .gnu.version      VERSYM           000000000000052a  0000052a</div><div class="line">       000000000000001a  0000000000000002   A       5     0     2</div><div class="line">  [ 8] .gnu.version_r    VERNEED          0000000000000548  00000548</div><div class="line">       0000000000000020  0000000000000000   A       6     1     8</div><div class="line">  [ 9] .rela.dyn         RELA             0000000000000568  00000568</div><div class="line">       0000000000000060  0000000000000018   A       5     0     8</div><div class="line">  [10] .rela.plt         RELA             00000000000005c8  000005c8</div><div class="line">       0000000000000048  0000000000000018  AI       5    20     8</div><div class="line">  [11] .plt              PROGBITS         0000000000000610  00000610</div><div class="line">       0000000000000050  0000000000000010  AX       0     0     16</div><div class="line">  [12] .text             PROGBITS         0000000000000660  00000660</div><div class="line">       00000000000000a8  0000000000000000  AX       0     0     4</div><div class="line">  [13] .rodata           PROGBITS         0000000000000708  00000708</div><div class="line">       0000000000000009  0000000000000001 AMS       0     0     1</div><div class="line">  [14] .eh_frame_hdr     PROGBITS         0000000000000714  00000714</div><div class="line">       0000000000000014  0000000000000000   A       0     0     4</div><div class="line">  [15] .eh_frame         PROGBITS         0000000000000728  00000728</div><div class="line">       0000000000000038  0000000000000000   A       0     0     8</div><div class="line">  [16] .preinit_array    PREINIT_ARRAY    0000000000010d58  00000d58</div><div class="line">       0000000000000010  0000000000000008  WA       0     0     8</div><div class="line">  [17] .init_array       INIT_ARRAY       0000000000010d68  00000d68</div><div class="line">       0000000000000010  0000000000000008  WA       0     0     8</div><div class="line">  [18] .fini_array       FINI_ARRAY       0000000000010d78  00000d78</div><div class="line">       0000000000000010  0000000000000008  WA       0     0     8</div><div class="line">  [19] .dynamic          DYNAMIC          0000000000010d88  00000d88</div><div class="line">       0000000000000220  0000000000000010  WA       6     0     8</div><div class="line">  [20] .got              PROGBITS         0000000000010fa8  00000fa8</div><div class="line">       0000000000000058  0000000000000008  WA       0     0     8</div><div class="line">  [21] .data             PROGBITS         0000000000011000  00001000</div><div class="line">       0000000000000008  0000000000000000  WA       0     0     8</div><div class="line">  [22] .comment          PROGBITS         0000000000000000  00001008</div><div class="line">       0000000000000064  0000000000000001  MS       0     0     1</div><div class="line">  [23] .shstrtab         STRTAB           0000000000000000  0000106c</div><div class="line">       00000000000000ea  0000000000000000           0     0     1</div><div class="line">Key to Flags:</div><div class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),</div><div class="line">  L (link order), O (extra OS processing required), G (group), T (TLS),</div><div class="line">  C (compressed), x (unknown), o (OS specific), E (exclude),</div><div class="line">  p (processor specific)</div><div class="line"></div><div class="line">There are no section groups in this file.</div><div class="line"></div><div class="line">Program Headers:</div><div class="line">  Type           Offset             VirtAddr           PhysAddr</div><div class="line">                 FileSiz            MemSiz              Flags  Align</div><div class="line">  PHDR           0x0000000000000040 0x0000000000000040 0x0000000000000040</div><div class="line">                 0x00000000000001f8 0x00000000000001f8  R E    0x8</div><div class="line">  INTERP         0x0000000000000238 0x0000000000000238 0x0000000000000238</div><div class="line">                 0x0000000000000015 0x0000000000000015  R      0x1</div><div class="line">      [Requesting program interpreter: /system/bin/linker64]</div><div class="line">  LOAD           0x0000000000000000 0x0000000000000000 0x0000000000000000</div><div class="line">                 0x0000000000000760 0x0000000000000760  R E    0x10000</div><div class="line">  LOAD           0x0000000000000d58 0x0000000000010d58 0x0000000000010d58</div><div class="line">                 0x00000000000002b0 0x00000000000002b0  RW     0x10000</div><div class="line">  DYNAMIC        0x0000000000000d88 0x0000000000010d88 0x0000000000010d88</div><div class="line">                 0x0000000000000220 0x0000000000000220  RW     0x8</div><div class="line">  NOTE           0x0000000000000250 0x0000000000000250 0x0000000000000250</div><div class="line">                 0x00000000000000bc 0x00000000000000bc  R      0x4</div><div class="line">  GNU_EH_FRAME   0x0000000000000714 0x0000000000000714 0x0000000000000714</div><div class="line">                 0x0000000000000014 0x0000000000000014  R      0x4</div><div class="line">  GNU_STACK      0x0000000000000000 0x0000000000000000 0x0000000000000000</div><div class="line">                 0x0000000000000000 0x0000000000000000  RW     0x10</div><div class="line">  GNU_RELRO      0x0000000000000d58 0x0000000000010d58 0x0000000000010d58</div><div class="line">                 0x00000000000002a8 0x00000000000002a8  R      0x1</div><div class="line"></div><div class="line"> Section to Segment mapping:</div><div class="line">  Segment Sections...</div><div class="line">   00</div><div class="line">   01     .interp</div><div class="line">   02     .interp .note.android.ident .note.gnu.build-id .hash .dynsym .dynstr .gnu.version .gnu.version_r .rela.dyn .rela.plt .plt .text .rodata .eh_frame_hdr .eh_frame</div><div class="line">   03     .preinit_array .init_array .fini_array .dynamic .got .data</div><div class="line">   04     .dynamic</div><div class="line">   05     .note.android.ident .note.gnu.build-id</div><div class="line">   06     .eh_frame_hdr</div><div class="line">   07</div><div class="line">   08     .preinit_array .init_array .fini_array .dynamic .got</div><div class="line"></div><div class="line">Dynamic section at offset 0xd88 contains 30 entries:</div><div class="line">  Tag        Type                         Name/Value</div><div class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so]</div><div class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libc.so]</div><div class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libm.so]</div><div class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libdl.so]</div><div class="line"> 0x0000000000000020 (PREINIT_ARRAY)      0x10d58</div><div class="line"> 0x0000000000000021 (PREINIT_ARRAYSZ)    0x10</div><div class="line"> 0x0000000000000019 (INIT_ARRAY)         0x10d68</div><div class="line"> 0x000000000000001b (INIT_ARRAYSZ)       16 (bytes)</div><div class="line"> 0x000000000000001a (FINI_ARRAY)         0x10d78</div><div class="line"> 0x000000000000001c (FINI_ARRAYSZ)       16 (bytes)</div><div class="line"> 0x0000000000000004 (HASH)               0x310</div><div class="line"> 0x0000000000000005 (STRTAB)             0x490</div><div class="line"> 0x0000000000000006 (SYMTAB)             0x358</div><div class="line"> 0x000000000000000a (STRSZ)              153 (bytes)</div><div class="line"> 0x000000000000000b (SYMENT)             24 (bytes)</div><div class="line"> 0x0000000000000015 (DEBUG)              0x0</div><div class="line"> 0x0000000000000003 (PLTGOT)             0x10fa8</div><div class="line"> 0x0000000000000002 (PLTRELSZ)           72 (bytes)</div><div class="line"> 0x0000000000000014 (PLTREL)             RELA</div><div class="line"> 0x0000000000000017 (JMPREL)             0x5c8</div><div class="line"> 0x0000000000000007 (RELA)               0x568</div><div class="line"> 0x0000000000000008 (RELASZ)             96 (bytes)</div><div class="line"> 0x0000000000000009 (RELAENT)            24 (bytes)</div><div class="line"> 0x0000000000000018 (BIND_NOW)</div><div class="line"> 0x000000006ffffffb (FLAGS_1)            Flags: NOW PIE</div><div class="line"> 0x000000006ffffffe (VERNEED)            0x548</div><div class="line"> 0x000000006fffffff (VERNEEDNUM)         1</div><div class="line"> 0x000000006ffffff0 (VERSYM)             0x52a</div><div class="line"> 0x000000006ffffff9 (RELACOUNT)          4</div><div class="line"> 0x0000000000000000 (NULL)               0x0</div><div class="line"></div><div class="line">Relocation section &apos;.rela.dyn&apos; at offset 0x568 contains 4 entries:</div><div class="line">  Offset          Info           Type           Sym. Value    Sym. Name + Addend</div><div class="line">000000010fe0  000000000403 R_AARCH64_RELATIV                    6d8</div><div class="line">000000010fe8  000000000403 R_AARCH64_RELATIV                    10d58</div><div class="line">000000010ff0  000000000403 R_AARCH64_RELATIV                    10d78</div><div class="line">000000010ff8  000000000403 R_AARCH64_RELATIV                    10d68</div><div class="line"></div><div class="line">Relocation section &apos;.rela.plt&apos; at offset 0x5c8 contains 3 entries:</div><div class="line">  Offset          Info           Type           Sym. Value    Sym. Name + Addend</div><div class="line">000000010fc0  000700000402 R_AARCH64_JUMP_SL 0000000000000000 printf@LIBC + 0</div><div class="line">000000010fc8  000b00000402 R_AARCH64_JUMP_SL 0000000000000000 __libc_init@LIBC + 0</div><div class="line">000000010fd0  000c00000402 R_AARCH64_JUMP_SL 0000000000000000 __cxa_atexit@LIBC + 0</div><div class="line"></div><div class="line">The decoding of unwind sections for machine type AArch64 is not currently supported.</div><div class="line"></div><div class="line">Symbol table &apos;.dynsym&apos; contains 13 entries:</div><div class="line">   Num:    Value          Size Type    Bind   Vis      Ndx Name</div><div class="line">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND</div><div class="line">     1: 0000000000000660     0 SECTION LOCAL  DEFAULT   12</div><div class="line">     2: 0000000000011000     0 SECTION LOCAL  DEFAULT   21</div><div class="line">     3: 0000000000011008     0 NOTYPE  LOCAL  DEFAULT  ABS __bss_start</div><div class="line">readelf: Warning: local symbol 3 found at index &gt;= .dynsym&apos;s sh_info value of 3</div><div class="line">     4: 0000000000011008     0 NOTYPE  LOCAL  DEFAULT  ABS _edata</div><div class="line">readelf: Warning: local symbol 4 found at index &gt;= .dynsym&apos;s sh_info value of 3</div><div class="line">     5: 0000000000011008     0 NOTYPE  LOCAL  DEFAULT  ABS _end</div><div class="line">readelf: Warning: local symbol 5 found at index &gt;= .dynsym&apos;s sh_info value of 3</div><div class="line">     6: 00000000000006d8    48 FUNC    GLOBAL DEFAULT   12 main</div><div class="line">     7: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND printf@LIBC (2)</div><div class="line">     8: 0000000000010d58     8 OBJECT  GLOBAL DEFAULT   16 __PREINIT_ARRAY__</div><div class="line">     9: 0000000000010d78     8 OBJECT  GLOBAL DEFAULT   18 __FINI_ARRAY__</div><div class="line">    10: 0000000000010d68     8 OBJECT  GLOBAL DEFAULT   17 __INIT_ARRAY__</div><div class="line">    11: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __libc_init@LIBC (2)</div><div class="line">    12: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __cxa_atexit@LIBC (2)</div><div class="line"></div><div class="line">Histogram for bucket list length (total of 3 buckets):</div><div class="line"> Length  Number     % of total  Coverage</div><div class="line">      0  0          (  0.0%)</div><div class="line">      1  1          ( 33.3%)     10.0%</div><div class="line">      2  0          (  0.0%)     10.0%</div><div class="line">      3  0          (  0.0%)     10.0%</div><div class="line">      4  1          ( 33.3%)     50.0%</div><div class="line">      5  1          ( 33.3%)    100.0%</div><div class="line"></div><div class="line">Version symbols section &apos;.gnu.version&apos; contains 13 entries:</div><div class="line"> Addr: 000000000000052a  Offset: 0x00052a  Link: 5 (.dynsym)</div><div class="line">  000:   0 (*local*)       0 (*local*)       0 (*local*)       1 (*global*)</div><div class="line">  004:   1 (*global*)      1 (*global*)      1 (*global*)      2 (LIBC)</div><div class="line">  008:   1 (*global*)      1 (*global*)      1 (*global*)      2 (LIBC)</div><div class="line">  00c:   2 (LIBC)</div><div class="line"></div><div class="line">Version needs section &apos;.gnu.version_r&apos; contains 1 entry:</div><div class="line"> Addr: 0x0000000000000548  Offset: 0x000548  Link: 6 (.dynstr)</div><div class="line">  000000: Version: 1  File: libc.so  Cnt: 1</div><div class="line">  0x0010:   Name: LIBC  Flags: none  Version: 2</div><div class="line"></div><div class="line">Displaying notes found in: .note.android.ident</div><div class="line">  Owner                 Data size       Description</div><div class="line">  Android              0x00000084       NT_VERSION (version)</div><div class="line">   description data: 15 00 00 00 72 31 36 62 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 34 34 37 39 34 39 39 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</div><div class="line"></div><div class="line">Displaying notes found in: .note.gnu.build-id</div><div class="line">  Owner                 Data size       Description</div><div class="line">  GNU                  0x00000014       NT_GNU_BUILD_ID (unique build ID bitstring)</div><div class="line">    Build ID: 510605f6988e76596585654d74ba4dabd91c00c4</div></pre></td></tr></table></figure>
<h1 id="实现一个解析器"><a href="#实现一个解析器" class="headerlink" title="实现一个解析器"></a>实现一个解析器</h1><p>github：<br><a href="https://github.com/imbaya2466/XFile" target="_blank" rel="external">https://github.com/imbaya2466/XFile</a></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>程序员的自我修养<br>ELF格式解析-v1.2 赵 凤 阳<br>ELF 文件格式分析 -滕启明<br>ELF for the ARM® 64-bit Architecture (AArch64)<br>ELF for the ARM® Architecture<br>CSAPP</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ELF/" rel="tag"># ELF</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/10/30/apk自动化加固1/" rel="next" title="apk自动化加固1">
                <i class="fa fa-chevron-left"></i> apk自动化加固1
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/11/10/cpp-随笔1/" rel="prev" title="cpp随笔1">
                cpp随笔1 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/1.png"
               alt="imbaya" />
          <p class="site-author-name" itemprop="name">imbaya</p>
           
              <p class="site-description motion-element" itemprop="description">..........</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">109</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">89</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前情提要"><span class="nav-number">1.</span> <span class="nav-text">前情提要</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#概述"><span class="nav-number">2.</span> <span class="nav-text">概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#文件类型"><span class="nav-number">2.1.</span> <span class="nav-text">文件类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#可重定位文件"><span class="nav-number">2.1.1.</span> <span class="nav-text">可重定位文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#共享目标文件"><span class="nav-number">2.1.2.</span> <span class="nav-text">共享目标文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可执行文件"><span class="nav-number">2.1.3.</span> <span class="nav-text">可执行文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文件格式概观"><span class="nav-number">2.2.</span> <span class="nav-text">文件格式概观</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ELF文件头"><span class="nav-number">2.2.1.</span> <span class="nav-text">ELF文件头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#节-section"><span class="nav-number">2.2.2.</span> <span class="nav-text">节(section)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#程序头表-program-header-table"><span class="nav-number">2.2.3.</span> <span class="nav-text">程序头表(program header table)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#节头表-section-header-table"><span class="nav-number">2.2.4.</span> <span class="nav-text">节头表 (section header table)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据类型"><span class="nav-number">2.3.</span> <span class="nav-text">数据类型</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ELF文件头-1"><span class="nav-number">3.</span> <span class="nav-text">ELF文件头</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ident"><span class="nav-number">3.1.</span> <span class="nav-text">ident</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MAG0-3"><span class="nav-number">3.1.1.</span> <span class="nav-text">MAG0-3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CLASS"><span class="nav-number">3.1.2.</span> <span class="nav-text">CLASS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DATA"><span class="nav-number">3.1.3.</span> <span class="nav-text">DATA</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VERSION"><span class="nav-number">3.1.4.</span> <span class="nav-text">VERSION</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OSABI"><span class="nav-number">3.1.5.</span> <span class="nav-text">OSABI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ABIVERSION"><span class="nav-number">3.1.6.</span> <span class="nav-text">ABIVERSION</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PAD"><span class="nav-number">3.1.7.</span> <span class="nav-text">PAD</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type"><span class="nav-number">3.2.</span> <span class="nav-text">type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#machine"><span class="nav-number">3.3.</span> <span class="nav-text">machine</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#version"><span class="nav-number">3.4.</span> <span class="nav-text">version</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#entry"><span class="nav-number">3.5.</span> <span class="nav-text">entry</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#phoff"><span class="nav-number">3.6.</span> <span class="nav-text">phoff</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shoff"><span class="nav-number">3.7.</span> <span class="nav-text">shoff</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#flags"><span class="nav-number">3.8.</span> <span class="nav-text">flags</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ehsize"><span class="nav-number">3.9.</span> <span class="nav-text">ehsize</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#phentsize"><span class="nav-number">3.10.</span> <span class="nav-text">phentsize</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#phnum"><span class="nav-number">3.11.</span> <span class="nav-text">phnum</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shentsize"><span class="nav-number">3.12.</span> <span class="nav-text">shentsize</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shnum"><span class="nav-number">3.13.</span> <span class="nav-text">shnum</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shstrndx"><span class="nav-number">3.14.</span> <span class="nav-text">shstrndx</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#节"><span class="nav-number">4.</span> <span class="nav-text">节</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#节头表"><span class="nav-number">4.1.</span> <span class="nav-text">节头表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#name"><span class="nav-number">4.1.1.</span> <span class="nav-text">name</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#type-1"><span class="nav-number">4.1.2.</span> <span class="nav-text">type</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#NULL"><span class="nav-number">4.1.2.1.</span> <span class="nav-text">NULL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PROGBITS"><span class="nav-number">4.1.2.2.</span> <span class="nav-text">PROGBITS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SYMTAB"><span class="nav-number">4.1.2.3.</span> <span class="nav-text">SYMTAB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#STRTAB"><span class="nav-number">4.1.2.4.</span> <span class="nav-text">STRTAB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RELA"><span class="nav-number">4.1.2.5.</span> <span class="nav-text">RELA</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HASH"><span class="nav-number">4.1.2.6.</span> <span class="nav-text">HASH</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DYNAMIC"><span class="nav-number">4.1.2.7.</span> <span class="nav-text">DYNAMIC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NOTE"><span class="nav-number">4.1.2.8.</span> <span class="nav-text">NOTE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NOBITS"><span class="nav-number">4.1.2.9.</span> <span class="nav-text">NOBITS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#REL"><span class="nav-number">4.1.2.10.</span> <span class="nav-text">REL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SHLIB"><span class="nav-number">4.1.2.11.</span> <span class="nav-text">SHLIB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DYNSYM"><span class="nav-number">4.1.2.12.</span> <span class="nav-text">DYNSYM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LOPROC"><span class="nav-number">4.1.2.13.</span> <span class="nav-text">LOPROC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HIPROC"><span class="nav-number">4.1.2.14.</span> <span class="nav-text">HIPROC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LOUSER"><span class="nav-number">4.1.2.15.</span> <span class="nav-text">LOUSER</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HIUSER"><span class="nav-number">4.1.2.16.</span> <span class="nav-text">HIUSER</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#flags-1"><span class="nav-number">4.1.3.</span> <span class="nav-text">flags</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WRITE"><span class="nav-number">4.1.3.1.</span> <span class="nav-text">WRITE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ALLOC"><span class="nav-number">4.1.3.2.</span> <span class="nav-text">ALLOC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EXECINSTR"><span class="nav-number">4.1.3.3.</span> <span class="nav-text">EXECINSTR</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MASKPROC"><span class="nav-number">4.1.3.4.</span> <span class="nav-text">MASKPROC</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#addr"><span class="nav-number">4.1.4.</span> <span class="nav-text">addr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#offset"><span class="nav-number">4.1.5.</span> <span class="nav-text">offset</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#size"><span class="nav-number">4.1.6.</span> <span class="nav-text">size</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#link"><span class="nav-number">4.1.7.</span> <span class="nav-text">link</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#info"><span class="nav-number">4.1.8.</span> <span class="nav-text">info</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#addralign"><span class="nav-number">4.1.9.</span> <span class="nav-text">addralign</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#entsize"><span class="nav-number">4.1.10.</span> <span class="nav-text">entsize</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#特殊节"><span class="nav-number">4.2.</span> <span class="nav-text">特殊节</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#bss"><span class="nav-number">4.2.1.</span> <span class="nav-text">bss</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#comment"><span class="nav-number">4.2.2.</span> <span class="nav-text">comment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#data-data1"><span class="nav-number">4.2.3.</span> <span class="nav-text">data/data1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#debug"><span class="nav-number">4.2.4.</span> <span class="nav-text">debug</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dynamic"><span class="nav-number">4.2.5.</span> <span class="nav-text">dynamic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dynstr"><span class="nav-number">4.2.6.</span> <span class="nav-text">dynstr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dynsym"><span class="nav-number">4.2.7.</span> <span class="nav-text">dynsym</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fini"><span class="nav-number">4.2.8.</span> <span class="nav-text">fini</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#got"><span class="nav-number">4.2.9.</span> <span class="nav-text">got</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hash"><span class="nav-number">4.2.10.</span> <span class="nav-text">hash</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#init"><span class="nav-number">4.2.11.</span> <span class="nav-text">init</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#interp"><span class="nav-number">4.2.12.</span> <span class="nav-text">interp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#line"><span class="nav-number">4.2.13.</span> <span class="nav-text">line</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#note"><span class="nav-number">4.2.14.</span> <span class="nav-text">note</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#plt"><span class="nav-number">4.2.15.</span> <span class="nav-text">plt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#relname-relaname"><span class="nav-number">4.2.16.</span> <span class="nav-text">relname/relaname</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#offset-1"><span class="nav-number">4.2.16.1.</span> <span class="nav-text">offset</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#info-1"><span class="nav-number">4.2.16.2.</span> <span class="nav-text">info</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#addend"><span class="nav-number">4.2.16.3.</span> <span class="nav-text">addend</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rodata-rodata1"><span class="nav-number">4.2.17.</span> <span class="nav-text">rodata/rodata1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shstrtab"><span class="nav-number">4.2.18.</span> <span class="nav-text">shstrtab</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#strtab"><span class="nav-number">4.2.19.</span> <span class="nav-text">strtab</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#symtab"><span class="nav-number">4.2.20.</span> <span class="nav-text">symtab</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#name-1"><span class="nav-number">4.2.20.1.</span> <span class="nav-text">name</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#info-2"><span class="nav-number">4.2.20.2.</span> <span class="nav-text">info</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#符号绑定-Symbol-Binding"><span class="nav-number">4.2.20.2.1.</span> <span class="nav-text">符号绑定(Symbol Binding)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#符号类型-Symbol-Types"><span class="nav-number">4.2.20.2.2.</span> <span class="nav-text">符号类型(Symbol Types)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#other"><span class="nav-number">4.2.20.3.</span> <span class="nav-text">other</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#shndx"><span class="nav-number">4.2.20.4.</span> <span class="nav-text">shndx</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ABS"><span class="nav-number">4.2.20.4.1.</span> <span class="nav-text">ABS</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#COMMON"><span class="nav-number">4.2.20.4.2.</span> <span class="nav-text">COMMON</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#UNDEF"><span class="nav-number">4.2.20.4.3.</span> <span class="nav-text">UNDEF</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#value"><span class="nav-number">4.2.20.5.</span> <span class="nav-text">value</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#size-1"><span class="nav-number">4.2.20.6.</span> <span class="nav-text">size</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#text"><span class="nav-number">4.2.21.</span> <span class="nav-text">text</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#段"><span class="nav-number">5.</span> <span class="nav-text">段</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#程序头"><span class="nav-number">5.1.</span> <span class="nav-text">程序头</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#type-2"><span class="nav-number">5.1.1.</span> <span class="nav-text">type</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#NULL-1"><span class="nav-number">5.1.1.1.</span> <span class="nav-text">NULL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LOAD"><span class="nav-number">5.1.1.2.</span> <span class="nav-text">LOAD</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DYNAMIC-1"><span class="nav-number">5.1.1.3.</span> <span class="nav-text">DYNAMIC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#INTERP"><span class="nav-number">5.1.1.4.</span> <span class="nav-text">INTERP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NOTE-1"><span class="nav-number">5.1.1.5.</span> <span class="nav-text">NOTE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SHLIB-1"><span class="nav-number">5.1.1.6.</span> <span class="nav-text">SHLIB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PHDR"><span class="nav-number">5.1.1.7.</span> <span class="nav-text">PHDR</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#L-H"><span class="nav-number">5.1.1.8.</span> <span class="nav-text">L-H</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#offset-2"><span class="nav-number">5.1.2.</span> <span class="nav-text">offset</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vaddr"><span class="nav-number">5.1.3.</span> <span class="nav-text">vaddr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#paddr"><span class="nav-number">5.1.4.</span> <span class="nav-text">paddr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#filesz"><span class="nav-number">5.1.5.</span> <span class="nav-text">filesz</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#memsz"><span class="nav-number">5.1.6.</span> <span class="nav-text">memsz</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#flags-2"><span class="nav-number">5.1.7.</span> <span class="nav-text">flags</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#align"><span class="nav-number">5.1.8.</span> <span class="nav-text">align</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#段内容"><span class="nav-number">5.2.</span> <span class="nav-text">段内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#注释段NOTE"><span class="nav-number">5.2.1.</span> <span class="nav-text">注释段NOTE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#程序解析器-动调连接器INTERP"><span class="nav-number">5.2.2.</span> <span class="nav-text">程序解析器/动调连接器INTERP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#动态段DYNAMIC"><span class="nav-number">5.2.3.</span> <span class="nav-text">动态段DYNAMIC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tag"><span class="nav-number">5.2.3.1.</span> <span class="nav-text">tag</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#共享目标的依赖关系"><span class="nav-number">5.2.3.2.</span> <span class="nav-text">共享目标的依赖关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#全局偏移量表got"><span class="nav-number">5.2.3.3.</span> <span class="nav-text">全局偏移量表got</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数连接表plt"><span class="nav-number">5.2.3.4.</span> <span class="nav-text">函数连接表plt</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解析符号"><span class="nav-number">5.2.3.5.</span> <span class="nav-text">解析符号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#哈希表"><span class="nav-number">5.2.3.6.</span> <span class="nav-text">哈希表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#初始化和终止函数"><span class="nav-number">5.2.3.7.</span> <span class="nav-text">初始化和终止函数</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#示例"><span class="nav-number">6.</span> <span class="nav-text">示例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#一个so的解析"><span class="nav-number">6.1.</span> <span class="nav-text">一个so的解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#源："><span class="nav-number">6.1.1.</span> <span class="nav-text">源：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#结果："><span class="nav-number">6.1.2.</span> <span class="nav-text">结果：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一个可执行文件的解析"><span class="nav-number">6.2.</span> <span class="nav-text">一个可执行文件的解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#源：-1"><span class="nav-number">6.2.1.</span> <span class="nav-text">源：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#结果：-1"><span class="nav-number">6.2.2.</span> <span class="nav-text">结果：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#实现一个解析器"><span class="nav-number">7.</span> <span class="nav-text">实现一个解析器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考"><span class="nav-number">8.</span> <span class="nav-text">参考</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">imbaya</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":100,"height":200,"hOffset":0,"vOffset":-50},"mobile":{"show":false},"react":{"opacityDefault":1,"opacityOnHover":1},"log":false});</script></body>
</html>
